{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import{useNavigation,useIsFocused}from'@react-navigation/native';import{Camera}from'expo-camera';import{observer}from'mobx-react';import{Container,View,Text}from'native-base';import React,{useCallback,useEffect,useState}from'react';import{useTranslation}from'react-i18next';import Alert from\"react-native-web/dist/exports/Alert\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Image from\"react-native-web/dist/exports/Image\";import{TextInput}from'react-native-gesture-handler';import Spinner from'react-native-loading-spinner-overlay';import{scanQrCode}from\"../../actions/transaction\";import Scanner from\"../../components/scanner\";import TitleBar from\"../../components/titleBar\";import{useStores}from\"../../stores\";import{translate}from\"../../utils/string\";import*as _ from'lodash';import{findBenefit,findDoctorOption}from\"../../utils/common\";import PhoneCall from\"../../components/phoneCall\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var QrScannerPage=observer(function(){var _useTranslation=useTranslation(),i18n=_useTranslation.i18n,t=_useTranslation.t;var stores=useStores();var navigation=useNavigation();var isFocused=useIsFocused();var currentTab=stores.appStore.currentTab;var values=stores.dataStore.values;var doctorId=values.doctorId,benefitCode=values.benefitCode;var _stores$configStore=stores.configStore,doctors=_stores$configStore.doctors,benefits=_stores$configStore.benefits;var doctor=findDoctorOption(doctors,doctorId);var doctorName=translate(doctor,i18n);var benefit=findBenefit(benefits,benefitCode);var benefitName=translate(benefit,i18n);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),spinning=_useState2[0],setSpinning=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),qrCode=_useState4[0],setQrCode=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),scanning=_useState6[0],setScanning=_useState6[1];var _useState7=useState(undefined),_useState8=_slicedToArray(_useState7,2),permission=_useState8[0],setPermission=_useState8[1];useEffect(function(){checkCameraPermission();},[]);if(scanning&&!isFocused){setScanning(false);}var checkCameraPermission=function _callee(){var _await$Camera$request,status;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regeneratorRuntime.awrap(Camera.requestPermissionsAsync());case 2:_await$Camera$request=_context.sent;status=_await$Camera$request.status;if(status===\"granted\"){setPermission(true);}else{setPermission(false);Alert.alert(t('Common.Error'),t('Error.CameraPermission'));}case 5:case\"end\":return _context.stop();}}},null,null,null,Promise);};var onChange=useCallback(function(text){setQrCode(_.toUpper(text));},[]);var onSubmit=useCallback(function _callee2(qrCode){var errorMsg;return _regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!scanning){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:setSpinning(true);setScanning(true);_context2.next=6;return _regeneratorRuntime.awrap(scanQrCode({stores:stores,navigation:navigation,qrCode:_.toUpper(qrCode),i18n:i18n}));case 6:errorMsg=_context2.sent;if(errorMsg){Alert.alert(t('Common.Error'),errorMsg,[{text:t('Common.Confirm'),onPress:function onPress(){setSpinning(false);setScanning(false);}}]);}else{setSpinning(false);}case 8:case\"end\":return _context2.stop();}}},null,null,null,Promise);},[scanning]);return _jsxs(Container,{children:[_jsx(Spinner,{visible:spinning,color:'red',size:'large',overlayColor:'rgba(0, 0, 0, 0.25)'}),_jsx(TitleBar,{title:t(currentTab+\".ScanQrCode\"),onBack:function onBack(){navigation.goBack();}}),_jsxs(View,{style:styleSheet.header,children:[_jsx(Image,{source:require(\"../../assets/images/UI/searchSmall.png\"),resizeMode:\"contain\",style:styleSheet.searchIcon}),_jsx(TextInput,{style:{width:\"100%\",height:\"100%\",fontSize:17},onChangeText:onChange,placeholder:t(currentTab+\".EnterQrCode\"),value:qrCode,autoCapitalize:\"characters\",textAlign:\"center\",maxLength:stores.appStore.currentTab==='Verify'?14:12,onSubmitEditing:function onSubmitEditing(e){return onSubmit(e.nativeEvent.text);}})]}),permission===false&&_jsx(View,{style:styleSheet.errorContainer,children:_jsx(Text,{style:styleSheet.errorText,children:t('Error.PleaseEnableCameraPermission')})}),isFocused&&permission&&_jsx(Scanner,{onScan:scanning?undefined:onSubmit,doctor:doctorName+\"/\"+benefitName,button:t(\"Verify.ST16\"),onBack:function onBack(){navigation.goBack();}}),_jsx(PhoneCall,{})]});});var styleSheet=StyleSheet.create({header:{height:40,marginBottom:10,backgroundColor:\"white\",borderRadius:20,marginHorizontal:10,justifyContent:\"center\",alignItems:\"center\"},searchIcon:{left:15,height:\"100%\",position:\"absolute\"},errorContainer:{flex:1,alignItems:\"center\",justifyContent:\"center\"},errorText:{fontSize:28,textAlign:\"center\"}});export default QrScannerPage;","map":{"version":3,"names":["useNavigation","useIsFocused","Camera","observer","Container","View","Text","React","useCallback","useEffect","useState","useTranslation","TextInput","Spinner","scanQrCode","Scanner","TitleBar","useStores","translate","_","findBenefit","findDoctorOption","PhoneCall","QrScannerPage","i18n","t","stores","navigation","isFocused","currentTab","appStore","values","dataStore","doctorId","benefitCode","configStore","doctors","benefits","doctor","doctorName","benefit","benefitName","spinning","setSpinning","qrCode","setQrCode","scanning","setScanning","undefined","permission","setPermission","checkCameraPermission","requestPermissionsAsync","status","Alert","alert","onChange","text","toUpper","onSubmit","errorMsg","onPress","goBack","styleSheet","header","require","searchIcon","width","height","fontSize","e","nativeEvent","errorContainer","errorText","StyleSheet","create","marginBottom","backgroundColor","borderRadius","marginHorizontal","justifyContent","alignItems","left","position","flex","textAlign"],"sources":["I:/Workspace/mediWS/mccWS/frontend-clinic-app/src/pages/qrScanner/index.tsx"],"sourcesContent":["import { useNavigation, useIsFocused } from '@react-navigation/native';\r\nimport { Camera } from 'expo-camera';\r\nimport { observer } from 'mobx-react';\r\nimport { Container, View, Text } from 'native-base';\r\nimport React, { useCallback, useEffect, useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Alert, StyleSheet, Image } from \"react-native\";\r\nimport { TextInput } from 'react-native-gesture-handler';\r\nimport Spinner from 'react-native-loading-spinner-overlay';\r\nimport { scanQrCode } from '../../actions/transaction';\r\nimport Scanner from '../../components/scanner';\r\nimport TitleBar from '../../components/titleBar';\r\nimport { useStores } from '../../stores';\r\nimport { translate } from '../../utils/string';\r\nimport * as _ from 'lodash';\r\nimport { findBenefit, findDoctorOption } from '../../utils/common';\r\nimport PhoneCall from \"../../components/phoneCall\";\r\n\r\nconst QrScannerPage = observer(() => {\r\n    const { i18n, t } = useTranslation();\r\n    const stores = useStores();\r\n    const navigation = useNavigation();\r\n    const isFocused = useIsFocused();\r\n\r\n    const { currentTab } = stores.appStore;\r\n\r\n    const { values } = stores.dataStore;\r\n    const { doctorId, benefitCode } = values;\r\n    const { doctors, benefits } = stores.configStore\r\n\r\n    // get doctor information\r\n    const doctor = findDoctorOption(doctors, doctorId);\r\n    const doctorName = translate(doctor, i18n);\r\n\r\n    // get benefit information\r\n    const benefit = findBenefit(benefits, benefitCode);\r\n    const benefitName = translate(benefit, i18n);\r\n\r\n    const [spinning, setSpinning] = useState(false);\r\n    const [qrCode, setQrCode] = useState('');\r\n    const [scanning, setScanning] = useState(false);\r\n    const [permission, setPermission] = useState<boolean | undefined>(undefined);\r\n\r\n    useEffect(() => {\r\n        checkCameraPermission();\r\n    }, []);\r\n    \r\n    if (scanning && !isFocused) {\r\n        setScanning(false);\r\n    }\r\n\r\n    const checkCameraPermission = async () => {\r\n        const { status } = await Camera.requestPermissionsAsync();\r\n        if (status === \"granted\") {\r\n            setPermission(true);\r\n        } else {\r\n            setPermission(false);\r\n            Alert.alert(t('Common.Error'), t('Error.CameraPermission'));\r\n        }\r\n    };\r\n\r\n    const onChange = useCallback((text: string) => {\r\n        setQrCode(_.toUpper(text));\r\n    }, []);\r\n\r\n    const onSubmit = useCallback(async (qrCode: string) => {\r\n        // avoid use scan again\r\n        if (scanning) {\r\n            return;\r\n        }\r\n        setSpinning(true);\r\n        setScanning(true);\r\n        const errorMsg = await scanQrCode({ stores, navigation, qrCode: _.toUpper(qrCode), i18n });\r\n\r\n        if (errorMsg) {\r\n            Alert.alert(\r\n                t('Common.Error'),\r\n                errorMsg,\r\n                [\r\n                    {\r\n                        text: t('Common.Confirm'),\r\n                        onPress: () => {\r\n                            setSpinning(false);\r\n                            setScanning(false);\r\n                        }\r\n                    }\r\n                ]\r\n            )\r\n        } else {\r\n            setSpinning(false);\r\n        }\r\n    }, [scanning]);\r\n\r\n    return (\r\n        <Container>\r\n            <Spinner\r\n                visible={spinning}\r\n                color={'red'}\r\n                size={'large'}\r\n                overlayColor={'rgba(0, 0, 0, 0.25)'}\r\n            />\r\n            <TitleBar\r\n                title={t(`${currentTab}.ScanQrCode`)}\r\n                onBack={() => {\r\n                    navigation.goBack();\r\n                }}\r\n            />\r\n            <View style={styleSheet.header}>\r\n                <Image\r\n                    source={require('../../assets/images/UI/searchSmall.png')}\r\n                    resizeMode={\"contain\"}\r\n                    style={styleSheet.searchIcon}\r\n                />\r\n                <TextInput\r\n                    style={{\r\n                        width: \"100%\",\r\n                        height: \"100%\",\r\n                        fontSize: 17,\r\n                    }}\r\n                    onChangeText={onChange}\r\n                    placeholder={t(`${currentTab}.EnterQrCode`)}\r\n                    value={qrCode}\r\n                    autoCapitalize=\"characters\"\r\n                    textAlign=\"center\"\r\n                    maxLength={ stores.appStore.currentTab === 'Verify' ? 14 : 12}\r\n                    onSubmitEditing={(e) => onSubmit(e.nativeEvent.text)}\r\n                />\r\n            </View>\r\n            {\r\n                permission === false && (\r\n                    <View style={styleSheet.errorContainer}>\r\n                        <Text style={styleSheet.errorText}>{t('Error.PleaseEnableCameraPermission')}</Text>\r\n                    </View>\r\n                )\r\n            }\r\n\r\n            {\r\n                isFocused && permission && (\r\n                    <Scanner\r\n                        onScan={scanning ? undefined : onSubmit}\r\n                        doctor={`${doctorName}/${benefitName}`}\r\n                        button={t(`Verify.ST16`)}\r\n                        onBack={() => {\r\n                            navigation.goBack()\r\n                        }}\r\n                    />\r\n                )\r\n            }\r\n            <PhoneCall />\r\n\r\n        </Container>\r\n    )\r\n});\r\n\r\nconst styleSheet = StyleSheet.create({\r\n    header: {\r\n        height: 40,\r\n        marginBottom: 10,\r\n        backgroundColor: \"white\",\r\n        borderRadius: 20,\r\n        marginHorizontal: 10,\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n    },\r\n    searchIcon: {\r\n        left: 15,\r\n        height: \"100%\",\r\n        position: \"absolute\",\r\n    },\r\n    errorContainer: {\r\n        flex: 1,\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\",\r\n    },\r\n    errorText: {\r\n        fontSize: 28,\r\n        textAlign: \"center\"\r\n    }\r\n});\r\n\r\nexport default QrScannerPage\r\n"],"mappings":"6HAAA,OAASA,aAAT,CAAwBC,YAAxB,KAA4C,0BAA5C,CACA,OAASC,MAAT,KAAuB,aAAvB,CACA,OAASC,QAAT,KAAyB,YAAzB,CACA,OAASC,SAAT,CAAoBC,IAApB,CAA0BC,IAA1B,KAAsC,aAAtC,CACA,MAAOC,CAAAA,KAAP,EAAgBC,WAAhB,CAA6BC,SAA7B,CAAwCC,QAAxC,KAAwD,OAAxD,CACA,OAASC,cAAT,KAA+B,eAA/B,C,+KAEA,OAASC,SAAT,KAA0B,8BAA1B,CACA,MAAOC,CAAAA,OAAP,KAAoB,sCAApB,CACA,OAASC,UAAT,iCACA,MAAOC,CAAAA,OAAP,gCACA,MAAOC,CAAAA,QAAP,iCACA,OAASC,SAAT,oBACA,OAASC,SAAT,0BACA,MAAO,GAAKC,CAAAA,CAAZ,KAAmB,QAAnB,CACA,OAASC,WAAT,CAAsBC,gBAAtB,0BACA,MAAOC,CAAAA,SAAP,kC,wFAEA,GAAMC,CAAAA,aAAa,CAAGpB,QAAQ,CAAC,UAAM,CACjC,oBAAoBQ,cAAc,EAAlC,CAAQa,IAAR,iBAAQA,IAAR,CAAcC,CAAd,iBAAcA,CAAd,CACA,GAAMC,CAAAA,MAAM,CAAGT,SAAS,EAAxB,CACA,GAAMU,CAAAA,UAAU,CAAG3B,aAAa,EAAhC,CACA,GAAM4B,CAAAA,SAAS,CAAG3B,YAAY,EAA9B,CAEA,GAAQ4B,CAAAA,UAAR,CAAuBH,MAAM,CAACI,QAA9B,CAAQD,UAAR,CAEA,GAAQE,CAAAA,MAAR,CAAmBL,MAAM,CAACM,SAA1B,CAAQD,MAAR,CACA,GAAQE,CAAAA,QAAR,CAAkCF,MAAlC,CAAQE,QAAR,CAAkBC,WAAlB,CAAkCH,MAAlC,CAAkBG,WAAlB,CACA,wBAA8BR,MAAM,CAACS,WAArC,CAAQC,OAAR,qBAAQA,OAAR,CAAiBC,QAAjB,qBAAiBA,QAAjB,CAGA,GAAMC,CAAAA,MAAM,CAAGjB,gBAAgB,CAACe,OAAD,CAAUH,QAAV,CAA/B,CACA,GAAMM,CAAAA,UAAU,CAAGrB,SAAS,CAACoB,MAAD,CAASd,IAAT,CAA5B,CAGA,GAAMgB,CAAAA,OAAO,CAAGpB,WAAW,CAACiB,QAAD,CAAWH,WAAX,CAA3B,CACA,GAAMO,CAAAA,WAAW,CAAGvB,SAAS,CAACsB,OAAD,CAAUhB,IAAV,CAA7B,CAEA,cAAgCd,QAAQ,CAAC,KAAD,CAAxC,wCAAOgC,QAAP,eAAiBC,WAAjB,eACA,eAA4BjC,QAAQ,CAAC,EAAD,CAApC,yCAAOkC,MAAP,eAAeC,SAAf,eACA,eAAgCnC,QAAQ,CAAC,KAAD,CAAxC,yCAAOoC,QAAP,eAAiBC,WAAjB,eACA,eAAoCrC,QAAQ,CAAsBsC,SAAtB,CAA5C,yCAAOC,UAAP,eAAmBC,aAAnB,eAEAzC,SAAS,CAAC,UAAM,CACZ0C,qBAAqB,GACxB,CAFQ,CAEN,EAFM,CAAT,CAIA,GAAIL,QAAQ,EAAI,CAAClB,SAAjB,CAA4B,CACxBmB,WAAW,CAAC,KAAD,CAAX,CACH,CAED,GAAMI,CAAAA,qBAAqB,CAAG,sNACDjD,MAAM,CAACkD,uBAAP,EADC,6CAClBC,MADkB,uBAClBA,MADkB,CAE1B,GAAIA,MAAM,GAAK,SAAf,CAA0B,CACtBH,aAAa,CAAC,IAAD,CAAb,CACH,CAFD,IAEO,CACHA,aAAa,CAAC,KAAD,CAAb,CACAI,KAAK,CAACC,KAAN,CAAY9B,CAAC,CAAC,cAAD,CAAb,CAA+BA,CAAC,CAAC,wBAAD,CAAhC,EACH,CAPyB,qEAA9B,CAUA,GAAM+B,CAAAA,QAAQ,CAAGhD,WAAW,CAAC,SAACiD,IAAD,CAAkB,CAC3CZ,SAAS,CAAC1B,CAAC,CAACuC,OAAF,CAAUD,IAAV,CAAD,CAAT,CACH,CAF2B,CAEzB,EAFyB,CAA5B,CAIA,GAAME,CAAAA,QAAQ,CAAGnD,WAAW,CAAC,kBAAOoC,MAAP,wIAErBE,QAFqB,mEAKzBH,WAAW,CAAC,IAAD,CAAX,CACAI,WAAW,CAAC,IAAD,CAAX,CANyB,kDAOFjC,UAAU,CAAC,CAAEY,MAAM,CAANA,MAAF,CAAUC,UAAU,CAAVA,UAAV,CAAsBiB,MAAM,CAAEzB,CAAC,CAACuC,OAAF,CAAUd,MAAV,CAA9B,CAAiDpB,IAAI,CAAJA,IAAjD,CAAD,CAPR,SAOnBoC,QAPmB,gBASzB,GAAIA,QAAJ,CAAc,CACVN,KAAK,CAACC,KAAN,CACI9B,CAAC,CAAC,cAAD,CADL,CAEImC,QAFJ,CAGI,CACI,CACIH,IAAI,CAAEhC,CAAC,CAAC,gBAAD,CADX,CAEIoC,OAAO,CAAE,kBAAM,CACXlB,WAAW,CAAC,KAAD,CAAX,CACAI,WAAW,CAAC,KAAD,CAAX,CACH,CALL,CADJ,CAHJ,EAaH,CAdD,IAcO,CACHJ,WAAW,CAAC,KAAD,CAAX,CACH,CAzBwB,sEAAD,CA0BzB,CAACG,QAAD,CA1ByB,CAA5B,CA4BA,MACI,OAAC,SAAD,YACI,KAAC,OAAD,EACI,OAAO,CAAEJ,QADb,CAEI,KAAK,CAAE,KAFX,CAGI,IAAI,CAAE,OAHV,CAII,YAAY,CAAE,qBAJlB,EADJ,CAOI,KAAC,QAAD,EACI,KAAK,CAAEjB,CAAC,CAAII,UAAJ,eADZ,CAEI,MAAM,CAAE,iBAAM,CACVF,UAAU,CAACmC,MAAX,GACH,CAJL,EAPJ,CAaI,MAAC,IAAD,EAAM,KAAK,CAAEC,UAAU,CAACC,MAAxB,WACI,KAAC,KAAD,EACI,MAAM,CAAEC,OAAO,0CADnB,CAEI,UAAU,CAAE,SAFhB,CAGI,KAAK,CAAEF,UAAU,CAACG,UAHtB,EADJ,CAMI,KAAC,SAAD,EACI,KAAK,CAAE,CACHC,KAAK,CAAE,MADJ,CAEHC,MAAM,CAAE,MAFL,CAGHC,QAAQ,CAAE,EAHP,CADX,CAMI,YAAY,CAAEb,QANlB,CAOI,WAAW,CAAE/B,CAAC,CAAII,UAAJ,gBAPlB,CAQI,KAAK,CAAEe,MARX,CASI,cAAc,CAAC,YATnB,CAUI,SAAS,CAAC,QAVd,CAWI,SAAS,CAAGlB,MAAM,CAACI,QAAP,CAAgBD,UAAhB,GAA+B,QAA/B,CAA0C,EAA1C,CAA+C,EAX/D,CAYI,eAAe,CAAE,yBAACyC,CAAD,QAAOX,CAAAA,QAAQ,CAACW,CAAC,CAACC,WAAF,CAAcd,IAAf,CAAf,EAZrB,EANJ,GAbJ,CAmCQR,UAAU,GAAK,KAAf,EACI,KAAC,IAAD,EAAM,KAAK,CAAEc,UAAU,CAACS,cAAxB,UACI,KAAC,IAAD,EAAM,KAAK,CAAET,UAAU,CAACU,SAAxB,UAAoChD,CAAC,CAAC,oCAAD,CAArC,EADJ,EApCZ,CA2CQG,SAAS,EAAIqB,UAAb,EACI,KAAC,OAAD,EACI,MAAM,CAAEH,QAAQ,CAAGE,SAAH,CAAeW,QADnC,CAEI,MAAM,CAAKpB,UAAL,KAAmBE,WAF7B,CAGI,MAAM,CAAEhB,CAAC,eAHb,CAII,MAAM,CAAE,iBAAM,CACVE,UAAU,CAACmC,MAAX,GACH,CANL,EA5CZ,CAsDI,KAAC,SAAD,IAtDJ,GADJ,CA2DH,CAtI6B,CAA9B,CAwIA,GAAMC,CAAAA,UAAU,CAAGW,UAAU,CAACC,MAAX,CAAkB,CACjCX,MAAM,CAAE,CACJI,MAAM,CAAE,EADJ,CAEJQ,YAAY,CAAE,EAFV,CAGJC,eAAe,CAAE,OAHb,CAIJC,YAAY,CAAE,EAJV,CAKJC,gBAAgB,CAAE,EALd,CAMJC,cAAc,CAAE,QANZ,CAOJC,UAAU,CAAE,QAPR,CADyB,CAUjCf,UAAU,CAAE,CACRgB,IAAI,CAAE,EADE,CAERd,MAAM,CAAE,MAFA,CAGRe,QAAQ,CAAE,UAHF,CAVqB,CAejCX,cAAc,CAAE,CACZY,IAAI,CAAE,CADM,CAEZH,UAAU,CAAE,QAFA,CAGZD,cAAc,CAAE,QAHJ,CAfiB,CAoBjCP,SAAS,CAAE,CACPJ,QAAQ,CAAE,EADH,CAEPgB,SAAS,CAAE,QAFJ,CApBsB,CAAlB,CAAnB,CA0BA,cAAe9D,CAAAA,aAAf"},"metadata":{},"sourceType":"module"}