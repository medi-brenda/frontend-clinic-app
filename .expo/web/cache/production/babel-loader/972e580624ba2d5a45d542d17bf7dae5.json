{"ast":null,"code":"\"use strict\";var _defineProperty=require(\"@babel/runtime/helpers/defineProperty\");var _reactJsxRuntime=require(\"react/jsx-runtime\");function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}var __extends=this&&this.__extends||function(){var _extendStatics=function extendStatics(d,b){_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b){if(b.hasOwnProperty(p))d[p]=b[p];}};return _extendStatics(d,b);};return function(d,b){_extendStatics(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s){if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p];}}return t;};return __assign.apply(this,arguments);};Object.defineProperty(exports,\"__esModule\",{value:true});var React=require(\"react\");var react_native_1=require(\"react-native-web/dist/index\");var image_zoom_style_1=require(\"./image-zoom.style\");var image_zoom_type_1=require(\"./image-zoom.type\");var ImageViewer=function(_super){__extends(ImageViewer,_super);function ImageViewer(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state=new image_zoom_type_1.ImageZoomState();_this.lastPositionX=null;_this.positionX=0;_this.animatedPositionX=new react_native_1.Animated.Value(0);_this.lastPositionY=null;_this.positionY=0;_this.animatedPositionY=new react_native_1.Animated.Value(0);_this.scale=1;_this.animatedScale=new react_native_1.Animated.Value(1);_this.zoomLastDistance=null;_this.zoomCurrentDistance=0;_this.lastTouchStartTime=0;_this.horizontalWholeOuterCounter=0;_this.swipeDownOffset=0;_this.horizontalWholeCounter=0;_this.verticalWholeCounter=0;_this.centerDiffX=0;_this.centerDiffY=0;_this.lastClickTime=0;_this.doubleClickX=0;_this.doubleClickY=0;_this.isDoubleClick=false;_this.isLongPress=false;_this.isHorizontalWrap=false;_this.imagePanResponder=react_native_1.PanResponder.create({onStartShouldSetPanResponder:_this.props.onStartShouldSetPanResponder,onPanResponderTerminationRequest:_this.props.onPanResponderTerminationRequest,onMoveShouldSetPanResponder:_this.props.onMoveShouldSetPanResponder,onPanResponderGrant:function onPanResponderGrant(evt){_this.lastPositionX=null;_this.lastPositionY=null;_this.zoomLastDistance=null;_this.horizontalWholeCounter=0;_this.verticalWholeCounter=0;_this.lastTouchStartTime=new Date().getTime();_this.isDoubleClick=false;_this.isLongPress=false;_this.isHorizontalWrap=false;if(_this.singleClickTimeout){clearTimeout(_this.singleClickTimeout);}if(evt.nativeEvent.changedTouches.length>1){var centerX=(evt.nativeEvent.changedTouches[0].pageX+evt.nativeEvent.changedTouches[1].pageX)/2;_this.centerDiffX=centerX-_this.props.cropWidth/2;var centerY=(evt.nativeEvent.changedTouches[0].pageY+evt.nativeEvent.changedTouches[1].pageY)/2;_this.centerDiffY=centerY-_this.props.cropHeight/2;}if(_this.longPressTimeout){clearTimeout(_this.longPressTimeout);}var _a=evt.nativeEvent,locationX=_a.locationX,locationY=_a.locationY,pageX=_a.pageX,pageY=_a.pageY;_this.longPressTimeout=setTimeout(function(){_this.isLongPress=true;if(_this.props.onLongPress){_this.props.onLongPress({locationX:locationX,locationY:locationY,pageX:pageX,pageY:pageY});}},_this.props.longPressTime);if(evt.nativeEvent.changedTouches.length<=1){if(new Date().getTime()-_this.lastClickTime<(_this.props.doubleClickInterval||0)){_this.lastClickTime=0;_this.doubleClickX=evt.nativeEvent.changedTouches[0].pageX;_this.doubleClickY=evt.nativeEvent.changedTouches[0].pageY;if(_this.props.onDoubleClick){_this.props.onDoubleClick({locationX:evt.nativeEvent.changedTouches[0].locationX,locationY:evt.nativeEvent.changedTouches[0].locationY,pageX:_this.doubleClickX,pageY:_this.doubleClickY});}clearTimeout(_this.longPressTimeout);_this.isDoubleClick=true;if(_this.props.enableDoubleClickZoom){if(_this.scale>1||_this.scale<1){_this.scale=1;_this.positionX=0;_this.positionY=0;}else{var beforeScale=_this.scale;_this.scale=2;var diffScale=_this.scale-beforeScale;_this.positionX=(_this.props.cropWidth/2-_this.doubleClickX)*diffScale/_this.scale;_this.positionY=(_this.props.cropHeight/2-_this.doubleClickY)*diffScale/_this.scale;}_this.imageDidMove('centerOn');react_native_1.Animated.parallel([react_native_1.Animated.timing(_this.animatedScale,{toValue:_this.scale,duration:100,useNativeDriver:!!_this.props.useNativeDriver}),react_native_1.Animated.timing(_this.animatedPositionX,{toValue:_this.positionX,duration:100,useNativeDriver:!!_this.props.useNativeDriver}),react_native_1.Animated.timing(_this.animatedPositionY,{toValue:_this.positionY,duration:100,useNativeDriver:!!_this.props.useNativeDriver})]).start();}}else{_this.lastClickTime=new Date().getTime();}}},onPanResponderMove:function onPanResponderMove(evt,gestureState){if(_this.isDoubleClick){return;}if(evt.nativeEvent.changedTouches.length<=1){var diffX=gestureState.dx-(_this.lastPositionX||0);if(_this.lastPositionX===null){diffX=0;}var diffY=gestureState.dy-(_this.lastPositionY||0);if(_this.lastPositionY===null){diffY=0;}_this.lastPositionX=gestureState.dx;_this.lastPositionY=gestureState.dy;_this.horizontalWholeCounter+=diffX;_this.verticalWholeCounter+=diffY;if(Math.abs(_this.horizontalWholeCounter)>5||Math.abs(_this.verticalWholeCounter)>5){clearTimeout(_this.longPressTimeout);}if(_this.props.panToMove){if(_this.swipeDownOffset===0){if(Math.abs(diffX)>Math.abs(diffY)){_this.isHorizontalWrap=true;}if(_this.props.imageWidth*_this.scale>_this.props.cropWidth){if(_this.horizontalWholeOuterCounter>0){if(diffX<0){if(_this.horizontalWholeOuterCounter>Math.abs(diffX)){_this.horizontalWholeOuterCounter+=diffX;diffX=0;}else{diffX+=_this.horizontalWholeOuterCounter;_this.horizontalWholeOuterCounter=0;if(_this.props.horizontalOuterRangeOffset){_this.props.horizontalOuterRangeOffset(0);}}}else{_this.horizontalWholeOuterCounter+=diffX;}}else if(_this.horizontalWholeOuterCounter<0){if(diffX>0){if(Math.abs(_this.horizontalWholeOuterCounter)>diffX){_this.horizontalWholeOuterCounter+=diffX;diffX=0;}else{diffX+=_this.horizontalWholeOuterCounter;_this.horizontalWholeOuterCounter=0;if(_this.props.horizontalOuterRangeOffset){_this.props.horizontalOuterRangeOffset(0);}}}else{_this.horizontalWholeOuterCounter+=diffX;}}else{}_this.positionX+=diffX/_this.scale;var horizontalMax=(_this.props.imageWidth*_this.scale-_this.props.cropWidth)/2/_this.scale;if(_this.positionX<-horizontalMax){_this.positionX=-horizontalMax;_this.horizontalWholeOuterCounter+=-1/1e10;}else if(_this.positionX>horizontalMax){_this.positionX=horizontalMax;_this.horizontalWholeOuterCounter+=1/1e10;}_this.animatedPositionX.setValue(_this.positionX);}else{_this.horizontalWholeOuterCounter+=diffX;}if(_this.horizontalWholeOuterCounter>(_this.props.maxOverflow||0)){_this.horizontalWholeOuterCounter=_this.props.maxOverflow||0;}else if(_this.horizontalWholeOuterCounter<-(_this.props.maxOverflow||0)){_this.horizontalWholeOuterCounter=-(_this.props.maxOverflow||0);}if(_this.horizontalWholeOuterCounter!==0){if(_this.props.horizontalOuterRangeOffset){_this.props.horizontalOuterRangeOffset(_this.horizontalWholeOuterCounter);}}}if(_this.props.imageHeight*_this.scale>_this.props.cropHeight){_this.positionY+=diffY/_this.scale;_this.animatedPositionY.setValue(_this.positionY);}else{if(_this.props.enableSwipeDown&&!_this.isHorizontalWrap){_this.swipeDownOffset+=diffY;if(_this.swipeDownOffset>0){_this.positionY+=diffY/_this.scale;_this.animatedPositionY.setValue(_this.positionY);_this.scale=_this.scale-diffY/1000;_this.animatedScale.setValue(_this.scale);}}}}}else{if(_this.longPressTimeout){clearTimeout(_this.longPressTimeout);}if(_this.props.pinchToZoom){var minX=void 0;var maxX=void 0;if(evt.nativeEvent.changedTouches[0].locationX>evt.nativeEvent.changedTouches[1].locationX){minX=evt.nativeEvent.changedTouches[1].pageX;maxX=evt.nativeEvent.changedTouches[0].pageX;}else{minX=evt.nativeEvent.changedTouches[0].pageX;maxX=evt.nativeEvent.changedTouches[1].pageX;}var minY=void 0;var maxY=void 0;if(evt.nativeEvent.changedTouches[0].locationY>evt.nativeEvent.changedTouches[1].locationY){minY=evt.nativeEvent.changedTouches[1].pageY;maxY=evt.nativeEvent.changedTouches[0].pageY;}else{minY=evt.nativeEvent.changedTouches[0].pageY;maxY=evt.nativeEvent.changedTouches[1].pageY;}var widthDistance=maxX-minX;var heightDistance=maxY-minY;var diagonalDistance=Math.sqrt(widthDistance*widthDistance+heightDistance*heightDistance);_this.zoomCurrentDistance=Number(diagonalDistance.toFixed(1));if(_this.zoomLastDistance!==null){var distanceDiff=(_this.zoomCurrentDistance-_this.zoomLastDistance)/200;var zoom=_this.scale+distanceDiff;if(zoom<(_this.props.minScale||0)){zoom=_this.props.minScale||0;}if(zoom>(_this.props.maxScale||0)){zoom=_this.props.maxScale||0;}var beforeScale=_this.scale;_this.scale=zoom;_this.animatedScale.setValue(_this.scale);var diffScale=_this.scale-beforeScale;_this.positionX-=_this.centerDiffX*diffScale/_this.scale;_this.positionY-=_this.centerDiffY*diffScale/_this.scale;_this.animatedPositionX.setValue(_this.positionX);_this.animatedPositionY.setValue(_this.positionY);}_this.zoomLastDistance=_this.zoomCurrentDistance;}}_this.imageDidMove('onPanResponderMove');},onPanResponderRelease:function onPanResponderRelease(evt,gestureState){if(_this.longPressTimeout){clearTimeout(_this.longPressTimeout);}if(_this.isDoubleClick){return;}if(_this.isLongPress){return;}var moveDistance=Math.sqrt(gestureState.dx*gestureState.dx+gestureState.dy*gestureState.dy);var _a=evt.nativeEvent,locationX=_a.locationX,locationY=_a.locationY,pageX=_a.pageX,pageY=_a.pageY;if(evt.nativeEvent.changedTouches.length===1&&moveDistance<(_this.props.clickDistance||0)){_this.singleClickTimeout=setTimeout(function(){if(_this.props.onClick){_this.props.onClick({locationX:locationX,locationY:locationY,pageX:pageX,pageY:pageY});}},_this.props.doubleClickInterval);}else{if(_this.props.responderRelease){_this.props.responderRelease(gestureState.vx,_this.scale);}_this.panResponderReleaseResolve();}},onPanResponderTerminate:function onPanResponderTerminate(){}});_this.resetScale=function(){_this.positionX=0;_this.positionY=0;_this.scale=1;_this.animatedScale.setValue(1);};_this.panResponderReleaseResolve=function(){if(_this.props.enableSwipeDown&&_this.props.swipeDownThreshold){if(_this.swipeDownOffset>_this.props.swipeDownThreshold){if(_this.props.onSwipeDown){_this.props.onSwipeDown();}return;}}if(_this.props.enableCenterFocus&&_this.scale<1){_this.scale=1;react_native_1.Animated.timing(_this.animatedScale,{toValue:_this.scale,duration:100,useNativeDriver:!!_this.props.useNativeDriver}).start();}if(_this.props.imageWidth*_this.scale<=_this.props.cropWidth){_this.positionX=0;react_native_1.Animated.timing(_this.animatedPositionX,{toValue:_this.positionX,duration:100,useNativeDriver:!!_this.props.useNativeDriver}).start();}if(_this.props.imageHeight*_this.scale<=_this.props.cropHeight){_this.positionY=0;react_native_1.Animated.timing(_this.animatedPositionY,{toValue:_this.positionY,duration:100,useNativeDriver:!!_this.props.useNativeDriver}).start();}if(_this.props.imageHeight*_this.scale>_this.props.cropHeight){var verticalMax=(_this.props.imageHeight*_this.scale-_this.props.cropHeight)/2/_this.scale;if(_this.positionY<-verticalMax){_this.positionY=-verticalMax;}else if(_this.positionY>verticalMax){_this.positionY=verticalMax;}react_native_1.Animated.timing(_this.animatedPositionY,{toValue:_this.positionY,duration:100,useNativeDriver:!!_this.props.useNativeDriver}).start();}if(_this.props.imageWidth*_this.scale>_this.props.cropWidth){var horizontalMax=(_this.props.imageWidth*_this.scale-_this.props.cropWidth)/2/_this.scale;if(_this.positionX<-horizontalMax){_this.positionX=-horizontalMax;}else if(_this.positionX>horizontalMax){_this.positionX=horizontalMax;}react_native_1.Animated.timing(_this.animatedPositionX,{toValue:_this.positionX,duration:100,useNativeDriver:!!_this.props.useNativeDriver}).start();}if(_this.props.enableCenterFocus&&_this.scale===1){_this.positionX=0;_this.positionY=0;react_native_1.Animated.timing(_this.animatedPositionX,{toValue:_this.positionX,duration:100,useNativeDriver:!!_this.props.useNativeDriver}).start();react_native_1.Animated.timing(_this.animatedPositionY,{toValue:_this.positionY,duration:100,useNativeDriver:!!_this.props.useNativeDriver}).start();}_this.horizontalWholeOuterCounter=0;_this.swipeDownOffset=0;_this.imageDidMove('onPanResponderRelease');};return _this;}ImageViewer.prototype.componentDidMount=function(){if(this.props.centerOn){this.centerOn(this.props.centerOn);}};ImageViewer.prototype.componentDidUpdate=function(prevProps){if(this.props.centerOn&&!prevProps.centerOn||this.props.centerOn&&prevProps.centerOn&&this.didCenterOnChange(prevProps.centerOn,this.props.centerOn)){this.centerOn(this.props.centerOn);}};ImageViewer.prototype.imageDidMove=function(type){if(this.props.onMove){this.props.onMove({type:type,positionX:this.positionX,positionY:this.positionY,scale:this.scale,zoomCurrentDistance:this.zoomCurrentDistance});}};ImageViewer.prototype.didCenterOnChange=function(params,paramsNext){return params.x!==paramsNext.x||params.y!==paramsNext.y||params.scale!==paramsNext.scale;};ImageViewer.prototype.centerOn=function(params){var _this=this;this.positionX=params.x;this.positionY=params.y;this.scale=params.scale;var duration=params.duration||300;react_native_1.Animated.parallel([react_native_1.Animated.timing(this.animatedScale,{toValue:this.scale,duration:duration,useNativeDriver:!!this.props.useNativeDriver}),react_native_1.Animated.timing(this.animatedPositionX,{toValue:this.positionX,duration:duration,useNativeDriver:!!this.props.useNativeDriver}),react_native_1.Animated.timing(this.animatedPositionY,{toValue:this.positionY,duration:duration,useNativeDriver:!!this.props.useNativeDriver})]).start(function(){_this.imageDidMove('centerOn');});};ImageViewer.prototype.handleLayout=function(event){if(this.props.layoutChange){this.props.layoutChange(event);}};ImageViewer.prototype.reset=function(){this.scale=1;this.animatedScale.setValue(this.scale);this.positionX=0;this.animatedPositionX.setValue(this.positionX);this.positionY=0;this.animatedPositionY.setValue(this.positionY);};ImageViewer.prototype.render=function(){var animateConf={transform:[{scale:this.animatedScale},{translateX:this.animatedPositionX},{translateY:this.animatedPositionY}]};var parentStyles=react_native_1.StyleSheet.flatten(this.props.style);return _reactJsxRuntime.jsx(react_native_1.View,_objectSpread(_objectSpread({style:__assign(__assign(__assign({},image_zoom_style_1.default.container),parentStyles),{width:this.props.cropWidth,height:this.props.cropHeight})},this.imagePanResponder.panHandlers),{},{children:_reactJsxRuntime.jsx(react_native_1.Animated.View,{style:animateConf,renderToHardwareTextureAndroid:this.props.useHardwareTextureAndroid,children:_reactJsxRuntime.jsx(react_native_1.View,{onLayout:this.handleLayout.bind(this),style:{width:this.props.imageWidth,height:this.props.imageHeight},children:this.props.children})})}));};ImageViewer.defaultProps=new image_zoom_type_1.ImageZoomProps();return ImageViewer;}(React.Component);exports.default=ImageViewer;","map":{"version":3,"sources":["../../src/image-zoom/image-zoom.component.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar React = require(\"react\");\nvar react_native_1 = require(\"react-native\");\nvar image_zoom_style_1 = require(\"./image-zoom.style\");\nvar image_zoom_type_1 = require(\"./image-zoom.type\");\nvar ImageViewer = /** @class */ (function (_super) {\n    __extends(ImageViewer, _super);\n    function ImageViewer() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.state = new image_zoom_type_1.ImageZoomState();\n        // 上次/当前/动画 x 位移\n        _this.lastPositionX = null;\n        _this.positionX = 0;\n        _this.animatedPositionX = new react_native_1.Animated.Value(0);\n        // 上次/当前/动画 y 位移\n        _this.lastPositionY = null;\n        _this.positionY = 0;\n        _this.animatedPositionY = new react_native_1.Animated.Value(0);\n        // 缩放大小\n        _this.scale = 1;\n        _this.animatedScale = new react_native_1.Animated.Value(1);\n        _this.zoomLastDistance = null;\n        _this.zoomCurrentDistance = 0;\n        // 上次手按下去的时间\n        _this.lastTouchStartTime = 0;\n        // 滑动过程中，整体横向过界偏移量\n        _this.horizontalWholeOuterCounter = 0;\n        // 滑动过程中，swipeDown 偏移量\n        _this.swipeDownOffset = 0;\n        // 滑动过程中，x y的总位移\n        _this.horizontalWholeCounter = 0;\n        _this.verticalWholeCounter = 0;\n        // 两手距离中心点位置\n        _this.centerDiffX = 0;\n        _this.centerDiffY = 0;\n        // 上一次点击的时间\n        _this.lastClickTime = 0;\n        // 双击时的位置\n        _this.doubleClickX = 0;\n        _this.doubleClickY = 0;\n        // 是否双击了\n        _this.isDoubleClick = false;\n        // 是否是长按\n        _this.isLongPress = false;\n        // 是否在左右滑\n        _this.isHorizontalWrap = false;\n        // 图片手势处理\n        _this.imagePanResponder = react_native_1.PanResponder.create({\n            // 要求成为响应者：\n            onStartShouldSetPanResponder: _this.props.onStartShouldSetPanResponder,\n            onPanResponderTerminationRequest: _this.props.onPanResponderTerminationRequest,\n            onMoveShouldSetPanResponder: _this.props.onMoveShouldSetPanResponder,\n            onPanResponderGrant: function (evt) {\n                // 开始手势操作\n                _this.lastPositionX = null;\n                _this.lastPositionY = null;\n                _this.zoomLastDistance = null;\n                _this.horizontalWholeCounter = 0;\n                _this.verticalWholeCounter = 0;\n                _this.lastTouchStartTime = new Date().getTime();\n                _this.isDoubleClick = false;\n                _this.isLongPress = false;\n                _this.isHorizontalWrap = false;\n                // 任何手势开始，都清空单击计时器\n                if (_this.singleClickTimeout) {\n                    clearTimeout(_this.singleClickTimeout);\n                }\n                if (evt.nativeEvent.changedTouches.length > 1) {\n                    var centerX = (evt.nativeEvent.changedTouches[0].pageX + evt.nativeEvent.changedTouches[1].pageX) / 2;\n                    _this.centerDiffX = centerX - _this.props.cropWidth / 2;\n                    var centerY = (evt.nativeEvent.changedTouches[0].pageY + evt.nativeEvent.changedTouches[1].pageY) / 2;\n                    _this.centerDiffY = centerY - _this.props.cropHeight / 2;\n                }\n                // 计算长按\n                if (_this.longPressTimeout) {\n                    clearTimeout(_this.longPressTimeout);\n                }\n                var _a = evt.nativeEvent, locationX = _a.locationX, locationY = _a.locationY, pageX = _a.pageX, pageY = _a.pageY;\n                _this.longPressTimeout = setTimeout(function () {\n                    _this.isLongPress = true;\n                    if (_this.props.onLongPress) {\n                        _this.props.onLongPress({ locationX: locationX, locationY: locationY, pageX: pageX, pageY: pageY });\n                    }\n                }, _this.props.longPressTime);\n                if (evt.nativeEvent.changedTouches.length <= 1) {\n                    // 一个手指的情况\n                    if (new Date().getTime() - _this.lastClickTime < (_this.props.doubleClickInterval || 0)) {\n                        // 认为触发了双击\n                        _this.lastClickTime = 0;\n                        // 因为可能触发放大，因此记录双击时的坐标位置\n                        _this.doubleClickX = evt.nativeEvent.changedTouches[0].pageX;\n                        _this.doubleClickY = evt.nativeEvent.changedTouches[0].pageY;\n                        if (_this.props.onDoubleClick) {\n                            _this.props.onDoubleClick({\n                                locationX: evt.nativeEvent.changedTouches[0].locationX,\n                                locationY: evt.nativeEvent.changedTouches[0].locationY,\n                                pageX: _this.doubleClickX,\n                                pageY: _this.doubleClickY,\n                            });\n                        }\n                        // 取消长按\n                        clearTimeout(_this.longPressTimeout);\n                        // 缩放\n                        _this.isDoubleClick = true;\n                        if (_this.props.enableDoubleClickZoom) {\n                            if (_this.scale > 1 || _this.scale < 1) {\n                                // 回归原位\n                                _this.scale = 1;\n                                _this.positionX = 0;\n                                _this.positionY = 0;\n                            }\n                            else {\n                                // 开始在位移地点缩放\n                                // 记录之前缩放比例\n                                // 此时 this.scale 一定为 1\n                                var beforeScale = _this.scale;\n                                // 开始缩放\n                                _this.scale = 2;\n                                // 缩放 diff\n                                var diffScale = _this.scale - beforeScale;\n                                // 找到两手中心点距离页面中心的位移\n                                // 移动位置\n                                _this.positionX = ((_this.props.cropWidth / 2 - _this.doubleClickX) * diffScale) / _this.scale;\n                                _this.positionY = ((_this.props.cropHeight / 2 - _this.doubleClickY) * diffScale) / _this.scale;\n                            }\n                            _this.imageDidMove('centerOn');\n                            react_native_1.Animated.parallel([\n                                react_native_1.Animated.timing(_this.animatedScale, {\n                                    toValue: _this.scale,\n                                    duration: 100,\n                                    useNativeDriver: !!_this.props.useNativeDriver,\n                                }),\n                                react_native_1.Animated.timing(_this.animatedPositionX, {\n                                    toValue: _this.positionX,\n                                    duration: 100,\n                                    useNativeDriver: !!_this.props.useNativeDriver,\n                                }),\n                                react_native_1.Animated.timing(_this.animatedPositionY, {\n                                    toValue: _this.positionY,\n                                    duration: 100,\n                                    useNativeDriver: !!_this.props.useNativeDriver,\n                                }),\n                            ]).start();\n                        }\n                    }\n                    else {\n                        _this.lastClickTime = new Date().getTime();\n                    }\n                }\n            },\n            onPanResponderMove: function (evt, gestureState) {\n                if (_this.isDoubleClick) {\n                    // 有时双击会被当做位移，这里屏蔽掉\n                    return;\n                }\n                if (evt.nativeEvent.changedTouches.length <= 1) {\n                    // x 位移\n                    var diffX = gestureState.dx - (_this.lastPositionX || 0);\n                    if (_this.lastPositionX === null) {\n                        diffX = 0;\n                    }\n                    // y 位移\n                    var diffY = gestureState.dy - (_this.lastPositionY || 0);\n                    if (_this.lastPositionY === null) {\n                        diffY = 0;\n                    }\n                    // 保留这一次位移作为下次的上一次位移\n                    _this.lastPositionX = gestureState.dx;\n                    _this.lastPositionY = gestureState.dy;\n                    _this.horizontalWholeCounter += diffX;\n                    _this.verticalWholeCounter += diffY;\n                    if (Math.abs(_this.horizontalWholeCounter) > 5 || Math.abs(_this.verticalWholeCounter) > 5) {\n                        // 如果位移超出手指范围，取消长按监听\n                        clearTimeout(_this.longPressTimeout);\n                    }\n                    if (_this.props.panToMove) {\n                        // 处理左右滑，如果正在 swipeDown，左右滑失效\n                        if (_this.swipeDownOffset === 0) {\n                            if (Math.abs(diffX) > Math.abs(diffY)) {\n                                _this.isHorizontalWrap = true;\n                            }\n                            // diffX > 0 表示手往右滑，图往左移动，反之同理\n                            // horizontalWholeOuterCounter > 0 表示溢出在左侧，反之在右侧，绝对值越大溢出越多\n                            if (_this.props.imageWidth * _this.scale > _this.props.cropWidth) {\n                                // 如果图片宽度大图盒子宽度， 可以横向拖拽\n                                // 没有溢出偏移量或者这次位移完全收回了偏移量才能拖拽\n                                if (_this.horizontalWholeOuterCounter > 0) {\n                                    // 溢出在右侧\n                                    if (diffX < 0) {\n                                        // 从右侧收紧\n                                        if (_this.horizontalWholeOuterCounter > Math.abs(diffX)) {\n                                            // 偏移量还没有用完\n                                            _this.horizontalWholeOuterCounter += diffX;\n                                            diffX = 0;\n                                        }\n                                        else {\n                                            // 溢出量置为0，偏移量减去剩余溢出量，并且可以被拖动\n                                            diffX += _this.horizontalWholeOuterCounter;\n                                            _this.horizontalWholeOuterCounter = 0;\n                                            if (_this.props.horizontalOuterRangeOffset) {\n                                                _this.props.horizontalOuterRangeOffset(0);\n                                            }\n                                        }\n                                    }\n                                    else {\n                                        // 向右侧扩增\n                                        _this.horizontalWholeOuterCounter += diffX;\n                                    }\n                                }\n                                else if (_this.horizontalWholeOuterCounter < 0) {\n                                    // 溢出在左侧\n                                    if (diffX > 0) {\n                                        // 从左侧收紧\n                                        if (Math.abs(_this.horizontalWholeOuterCounter) > diffX) {\n                                            // 偏移量还没有用完\n                                            _this.horizontalWholeOuterCounter += diffX;\n                                            diffX = 0;\n                                        }\n                                        else {\n                                            // 溢出量置为0，偏移量减去剩余溢出量，并且可以被拖动\n                                            diffX += _this.horizontalWholeOuterCounter;\n                                            _this.horizontalWholeOuterCounter = 0;\n                                            if (_this.props.horizontalOuterRangeOffset) {\n                                                _this.props.horizontalOuterRangeOffset(0);\n                                            }\n                                        }\n                                    }\n                                    else {\n                                        // 向左侧扩增\n                                        _this.horizontalWholeOuterCounter += diffX;\n                                    }\n                                }\n                                else {\n                                    // 溢出偏移量为0，正常移动\n                                }\n                                // 产生位移\n                                _this.positionX += diffX / _this.scale;\n                                // 但是横向不能出现黑边\n                                // 横向能容忍的绝对值\n                                var horizontalMax = (_this.props.imageWidth * _this.scale - _this.props.cropWidth) / 2 / _this.scale;\n                                if (_this.positionX < -horizontalMax) {\n                                    // 超越了左边临界点，还在继续向左移动\n                                    _this.positionX = -horizontalMax;\n                                    // 让其产生细微位移，偏离轨道\n                                    _this.horizontalWholeOuterCounter += -1 / 1e10;\n                                }\n                                else if (_this.positionX > horizontalMax) {\n                                    // 超越了右侧临界点，还在继续向右移动\n                                    _this.positionX = horizontalMax;\n                                    // 让其产生细微位移，偏离轨道\n                                    _this.horizontalWholeOuterCounter += 1 / 1e10;\n                                }\n                                _this.animatedPositionX.setValue(_this.positionX);\n                            }\n                            else {\n                                // 不能横向拖拽，全部算做溢出偏移量\n                                _this.horizontalWholeOuterCounter += diffX;\n                            }\n                            // 溢出量不会超过设定界限\n                            if (_this.horizontalWholeOuterCounter > (_this.props.maxOverflow || 0)) {\n                                _this.horizontalWholeOuterCounter = _this.props.maxOverflow || 0;\n                            }\n                            else if (_this.horizontalWholeOuterCounter < -(_this.props.maxOverflow || 0)) {\n                                _this.horizontalWholeOuterCounter = -(_this.props.maxOverflow || 0);\n                            }\n                            if (_this.horizontalWholeOuterCounter !== 0) {\n                                // 如果溢出偏移量不是0，执行溢出回调\n                                if (_this.props.horizontalOuterRangeOffset) {\n                                    _this.props.horizontalOuterRangeOffset(_this.horizontalWholeOuterCounter);\n                                }\n                            }\n                        }\n                        // 如果图片高度大于盒子高度， 可以纵向弹性拖拽\n                        if (_this.props.imageHeight * _this.scale > _this.props.cropHeight) {\n                            _this.positionY += diffY / _this.scale;\n                            _this.animatedPositionY.setValue(_this.positionY);\n                            // 如果图片上边缘脱离屏幕上边缘，则进入 swipeDown 动作\n                            // if (\n                            //   (this.props.imageHeight / 2 - this.positionY) * this.scale <\n                            //   this.props.cropHeight / 2\n                            // ) {\n                            //   if (this.props.enableSwipeDown) {\n                            //     this.swipeDownOffset += diffY\n                            //     // 只要滑动溢出量不小于 0，就可以拖动\n                            //     if (this.swipeDownOffset > 0) {\n                            //       this.positionY += diffY / this.scale\n                            //       this.animatedPositionY.setValue(this.positionY)\n                            //       // 越到下方，缩放越小\n                            //       this.scale = this.scale - diffY / 1000\n                            //       this.animatedScale.setValue(this.scale)\n                            //     }\n                            //   }\n                            // }\n                        }\n                        else {\n                            // swipeDown 不允许在已经有横向偏移量时触发\n                            if (_this.props.enableSwipeDown && !_this.isHorizontalWrap) {\n                                // 图片高度小于盒子高度，只能向下拖拽，而且一定是 swipeDown 动作\n                                _this.swipeDownOffset += diffY;\n                                // 只要滑动溢出量不小于 0，就可以拖动\n                                if (_this.swipeDownOffset > 0) {\n                                    _this.positionY += diffY / _this.scale;\n                                    _this.animatedPositionY.setValue(_this.positionY);\n                                    // 越到下方，缩放越小\n                                    _this.scale = _this.scale - diffY / 1000;\n                                    _this.animatedScale.setValue(_this.scale);\n                                }\n                            }\n                        }\n                    }\n                }\n                else {\n                    // 多个手指的情况\n                    // 取消长按状态\n                    if (_this.longPressTimeout) {\n                        clearTimeout(_this.longPressTimeout);\n                    }\n                    if (_this.props.pinchToZoom) {\n                        // 找最小的 x 和最大的 x\n                        var minX = void 0;\n                        var maxX = void 0;\n                        if (evt.nativeEvent.changedTouches[0].locationX > evt.nativeEvent.changedTouches[1].locationX) {\n                            minX = evt.nativeEvent.changedTouches[1].pageX;\n                            maxX = evt.nativeEvent.changedTouches[0].pageX;\n                        }\n                        else {\n                            minX = evt.nativeEvent.changedTouches[0].pageX;\n                            maxX = evt.nativeEvent.changedTouches[1].pageX;\n                        }\n                        var minY = void 0;\n                        var maxY = void 0;\n                        if (evt.nativeEvent.changedTouches[0].locationY > evt.nativeEvent.changedTouches[1].locationY) {\n                            minY = evt.nativeEvent.changedTouches[1].pageY;\n                            maxY = evt.nativeEvent.changedTouches[0].pageY;\n                        }\n                        else {\n                            minY = evt.nativeEvent.changedTouches[0].pageY;\n                            maxY = evt.nativeEvent.changedTouches[1].pageY;\n                        }\n                        var widthDistance = maxX - minX;\n                        var heightDistance = maxY - minY;\n                        var diagonalDistance = Math.sqrt(widthDistance * widthDistance + heightDistance * heightDistance);\n                        _this.zoomCurrentDistance = Number(diagonalDistance.toFixed(1));\n                        if (_this.zoomLastDistance !== null) {\n                            var distanceDiff = (_this.zoomCurrentDistance - _this.zoomLastDistance) / 200;\n                            var zoom = _this.scale + distanceDiff;\n                            if (zoom < (_this.props.minScale || 0)) {\n                                zoom = _this.props.minScale || 0;\n                            }\n                            if (zoom > (_this.props.maxScale || 0)) {\n                                zoom = _this.props.maxScale || 0;\n                            }\n                            // 记录之前缩放比例\n                            var beforeScale = _this.scale;\n                            // 开始缩放\n                            _this.scale = zoom;\n                            _this.animatedScale.setValue(_this.scale);\n                            // 图片要慢慢往两个手指的中心点移动\n                            // 缩放 diff\n                            var diffScale = _this.scale - beforeScale;\n                            // 找到两手中心点距离页面中心的位移\n                            // 移动位置\n                            _this.positionX -= (_this.centerDiffX * diffScale) / _this.scale;\n                            _this.positionY -= (_this.centerDiffY * diffScale) / _this.scale;\n                            _this.animatedPositionX.setValue(_this.positionX);\n                            _this.animatedPositionY.setValue(_this.positionY);\n                        }\n                        _this.zoomLastDistance = _this.zoomCurrentDistance;\n                    }\n                }\n                _this.imageDidMove('onPanResponderMove');\n            },\n            onPanResponderRelease: function (evt, gestureState) {\n                // 取消长按\n                if (_this.longPressTimeout) {\n                    clearTimeout(_this.longPressTimeout);\n                }\n                // 双击结束，结束尾判断\n                if (_this.isDoubleClick) {\n                    return;\n                }\n                // 长按结束，结束尾判断\n                if (_this.isLongPress) {\n                    return;\n                }\n                // 如果是单个手指、距离上次按住大于预设秒、滑动距离小于预设值, 则可能是单击（如果后续双击间隔内没有开始手势）\n                // const stayTime = new Date().getTime() - this.lastTouchStartTime!\n                var moveDistance = Math.sqrt(gestureState.dx * gestureState.dx + gestureState.dy * gestureState.dy);\n                var _a = evt.nativeEvent, locationX = _a.locationX, locationY = _a.locationY, pageX = _a.pageX, pageY = _a.pageY;\n                if (evt.nativeEvent.changedTouches.length === 1 && moveDistance < (_this.props.clickDistance || 0)) {\n                    _this.singleClickTimeout = setTimeout(function () {\n                        if (_this.props.onClick) {\n                            _this.props.onClick({ locationX: locationX, locationY: locationY, pageX: pageX, pageY: pageY });\n                        }\n                    }, _this.props.doubleClickInterval);\n                }\n                else {\n                    // 多手势结束，或者滑动结束\n                    if (_this.props.responderRelease) {\n                        _this.props.responderRelease(gestureState.vx, _this.scale);\n                    }\n                    _this.panResponderReleaseResolve();\n                }\n            },\n            onPanResponderTerminate: function () {\n                //\n            },\n        });\n        _this.resetScale = function () {\n            _this.positionX = 0;\n            _this.positionY = 0;\n            _this.scale = 1;\n            _this.animatedScale.setValue(1);\n        };\n        _this.panResponderReleaseResolve = function () {\n            // 判断是否是 swipeDown\n            if (_this.props.enableSwipeDown && _this.props.swipeDownThreshold) {\n                if (_this.swipeDownOffset > _this.props.swipeDownThreshold) {\n                    if (_this.props.onSwipeDown) {\n                        _this.props.onSwipeDown();\n                    }\n                    // Stop reset.\n                    return;\n                }\n            }\n            if (_this.props.enableCenterFocus && _this.scale < 1) {\n                // 如果缩放小于1，强制重置为 1\n                _this.scale = 1;\n                react_native_1.Animated.timing(_this.animatedScale, {\n                    toValue: _this.scale,\n                    duration: 100,\n                    useNativeDriver: !!_this.props.useNativeDriver,\n                }).start();\n            }\n            if (_this.props.imageWidth * _this.scale <= _this.props.cropWidth) {\n                // 如果图片宽度小于盒子宽度，横向位置重置\n                _this.positionX = 0;\n                react_native_1.Animated.timing(_this.animatedPositionX, {\n                    toValue: _this.positionX,\n                    duration: 100,\n                    useNativeDriver: !!_this.props.useNativeDriver,\n                }).start();\n            }\n            if (_this.props.imageHeight * _this.scale <= _this.props.cropHeight) {\n                // 如果图片高度小于盒子高度，纵向位置重置\n                _this.positionY = 0;\n                react_native_1.Animated.timing(_this.animatedPositionY, {\n                    toValue: _this.positionY,\n                    duration: 100,\n                    useNativeDriver: !!_this.props.useNativeDriver,\n                }).start();\n            }\n            // 横向肯定不会超出范围，由拖拽时控制\n            // 如果图片高度大于盒子高度，纵向不能出现黑边\n            if (_this.props.imageHeight * _this.scale > _this.props.cropHeight) {\n                // 纵向能容忍的绝对值\n                var verticalMax = (_this.props.imageHeight * _this.scale - _this.props.cropHeight) / 2 / _this.scale;\n                if (_this.positionY < -verticalMax) {\n                    _this.positionY = -verticalMax;\n                }\n                else if (_this.positionY > verticalMax) {\n                    _this.positionY = verticalMax;\n                }\n                react_native_1.Animated.timing(_this.animatedPositionY, {\n                    toValue: _this.positionY,\n                    duration: 100,\n                    useNativeDriver: !!_this.props.useNativeDriver,\n                }).start();\n            }\n            if (_this.props.imageWidth * _this.scale > _this.props.cropWidth) {\n                // 纵向能容忍的绝对值\n                var horizontalMax = (_this.props.imageWidth * _this.scale - _this.props.cropWidth) / 2 / _this.scale;\n                if (_this.positionX < -horizontalMax) {\n                    _this.positionX = -horizontalMax;\n                }\n                else if (_this.positionX > horizontalMax) {\n                    _this.positionX = horizontalMax;\n                }\n                react_native_1.Animated.timing(_this.animatedPositionX, {\n                    toValue: _this.positionX,\n                    duration: 100,\n                    useNativeDriver: !!_this.props.useNativeDriver,\n                }).start();\n            }\n            // 拖拽正常结束后,如果没有缩放,直接回到0,0点\n            if (_this.props.enableCenterFocus && _this.scale === 1) {\n                _this.positionX = 0;\n                _this.positionY = 0;\n                react_native_1.Animated.timing(_this.animatedPositionX, {\n                    toValue: _this.positionX,\n                    duration: 100,\n                    useNativeDriver: !!_this.props.useNativeDriver,\n                }).start();\n                react_native_1.Animated.timing(_this.animatedPositionY, {\n                    toValue: _this.positionY,\n                    duration: 100,\n                    useNativeDriver: !!_this.props.useNativeDriver,\n                }).start();\n            }\n            // 水平溢出量置空\n            _this.horizontalWholeOuterCounter = 0;\n            // swipeDown 溢出量置空\n            _this.swipeDownOffset = 0;\n            _this.imageDidMove('onPanResponderRelease');\n        };\n        return _this;\n    }\n    ImageViewer.prototype.componentDidMount = function () {\n        if (this.props.centerOn) {\n            this.centerOn(this.props.centerOn);\n        }\n    };\n    ImageViewer.prototype.componentDidUpdate = function (prevProps) {\n        // Either centerOn has never been called, or it is a repeat and we should ignore it\n        if ((this.props.centerOn && !prevProps.centerOn) ||\n            (this.props.centerOn && prevProps.centerOn && this.didCenterOnChange(prevProps.centerOn, this.props.centerOn))) {\n            this.centerOn(this.props.centerOn);\n        }\n    };\n    ImageViewer.prototype.imageDidMove = function (type) {\n        if (this.props.onMove) {\n            this.props.onMove({\n                type: type,\n                positionX: this.positionX,\n                positionY: this.positionY,\n                scale: this.scale,\n                zoomCurrentDistance: this.zoomCurrentDistance,\n            });\n        }\n    };\n    ImageViewer.prototype.didCenterOnChange = function (params, paramsNext) {\n        return params.x !== paramsNext.x || params.y !== paramsNext.y || params.scale !== paramsNext.scale;\n    };\n    ImageViewer.prototype.centerOn = function (params) {\n        var _this = this;\n        this.positionX = params.x;\n        this.positionY = params.y;\n        this.scale = params.scale;\n        var duration = params.duration || 300;\n        react_native_1.Animated.parallel([\n            react_native_1.Animated.timing(this.animatedScale, {\n                toValue: this.scale,\n                duration: duration,\n                useNativeDriver: !!this.props.useNativeDriver,\n            }),\n            react_native_1.Animated.timing(this.animatedPositionX, {\n                toValue: this.positionX,\n                duration: duration,\n                useNativeDriver: !!this.props.useNativeDriver,\n            }),\n            react_native_1.Animated.timing(this.animatedPositionY, {\n                toValue: this.positionY,\n                duration: duration,\n                useNativeDriver: !!this.props.useNativeDriver,\n            }),\n        ]).start(function () {\n            _this.imageDidMove('centerOn');\n        });\n    };\n    /**\n     * 图片区域视图渲染完毕\n     */\n    ImageViewer.prototype.handleLayout = function (event) {\n        if (this.props.layoutChange) {\n            this.props.layoutChange(event);\n        }\n    };\n    /**\n     * 重置大小和位置\n     */\n    ImageViewer.prototype.reset = function () {\n        this.scale = 1;\n        this.animatedScale.setValue(this.scale);\n        this.positionX = 0;\n        this.animatedPositionX.setValue(this.positionX);\n        this.positionY = 0;\n        this.animatedPositionY.setValue(this.positionY);\n    };\n    ImageViewer.prototype.render = function () {\n        var animateConf = {\n            transform: [\n                {\n                    scale: this.animatedScale,\n                },\n                {\n                    translateX: this.animatedPositionX,\n                },\n                {\n                    translateY: this.animatedPositionY,\n                },\n            ],\n        };\n        var parentStyles = react_native_1.StyleSheet.flatten(this.props.style);\n        return (<react_native_1.View style={__assign(__assign(__assign({}, image_zoom_style_1.default.container), parentStyles), { width: this.props.cropWidth, height: this.props.cropHeight })} {...this.imagePanResponder.panHandlers}>\n        <react_native_1.Animated.View style={animateConf} renderToHardwareTextureAndroid={this.props.useHardwareTextureAndroid}>\n          <react_native_1.View onLayout={this.handleLayout.bind(this)} style={{\n            width: this.props.imageWidth,\n            height: this.props.imageHeight,\n        }}>\n            {this.props.children}\n          </react_native_1.View>\n        </react_native_1.Animated.View>\n      </react_native_1.View>);\n    };\n    ImageViewer.defaultProps = new image_zoom_type_1.ImageZoomProps();\n    return ImageViewer;\n}(React.Component));\nexports.default = ImageViewer;\n//# sourceMappingURL=image-zoom.component.js.map"]},"metadata":{},"sourceType":"script"}