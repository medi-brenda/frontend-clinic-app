{"ast":null,"code":"\"use strict\";var _defineProperty=require(\"@babel/runtime/helpers/defineProperty\");var _reactJsxRuntime=require(\"react/jsx-runtime\");function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b){if(b.hasOwnProperty(p))d[p]=b[p];}};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();var __assign=this&&this.__assign||Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s){if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p];}}return t;};var __rest=this&&this.__rest||function(s,e){var t={};for(var p in s){if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];}if(s!=null&&typeof Object.getOwnPropertySymbols===\"function\")for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++){if(e.indexOf(p[i])<0)t[p[i]]=s[p[i]];}return t;};Object.defineProperty(exports,\"__esModule\",{value:true});var React=require(\"react\");var react_native_1=require(\"react-native-web/dist/index\");var react_native_image_pan_zoom_1=require(\"react-native-image-pan-zoom\");var image_viewer_style_1=require(\"./image-viewer.style\");var image_viewer_type_1=require(\"./image-viewer.type\");var ImageViewer=function(_super){__extends(ImageViewer,_super);function ImageViewer(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state=new image_viewer_type_1.State();_this.fadeAnim=new react_native_1.Animated.Value(0);_this.standardPositionX=0;_this.positionXNumber=0;_this.positionX=new react_native_1.Animated.Value(0);_this.width=0;_this.height=0;_this.styles=image_viewer_style_1.default(0,0,'transparent');_this.hasLayout=false;_this.loadedIndex=new Map();_this.handleLongPressWithIndex=new Map();_this.imageRefs=[];_this.resetImageByIndex=function(index){_this.imageRefs[index]&&_this.imageRefs[index].reset();};_this.preloadImage=function(index){if(index<_this.state.imageSizes.length){_this.loadImage(index+1);}};_this.handleHorizontalOuterRangeOffset=function(offsetX){if(offsetX===void 0){offsetX=0;}_this.positionXNumber=_this.standardPositionX+offsetX;_this.positionX.setValue(_this.positionXNumber);var offsetXRTL=!react_native_1.I18nManager.isRTL?offsetX:-offsetX;if(offsetXRTL<0){if(_this.state.currentShowIndex||0<_this.props.imageUrls.length-1){_this.loadImage((_this.state.currentShowIndex||0)+1);}}else if(offsetXRTL>0){if(_this.state.currentShowIndex||0>0){_this.loadImage((_this.state.currentShowIndex||0)-1);}}};_this.handleResponderRelease=function(vx){if(vx===void 0){vx=0;}var vxRTL=react_native_1.I18nManager.isRTL?-vx:vx;var isLeftMove=react_native_1.I18nManager.isRTL?_this.positionXNumber-_this.standardPositionX<-(_this.props.flipThreshold||0):_this.positionXNumber-_this.standardPositionX>(_this.props.flipThreshold||0);var isRightMove=react_native_1.I18nManager.isRTL?_this.positionXNumber-_this.standardPositionX>(_this.props.flipThreshold||0):_this.positionXNumber-_this.standardPositionX<-(_this.props.flipThreshold||0);if(vxRTL>0.7){_this.goBack.call(_this);if(_this.state.currentShowIndex||0>0){_this.loadImage((_this.state.currentShowIndex||0)-1);}return;}else if(vxRTL<-0.7){_this.goNext.call(_this);if(_this.state.currentShowIndex||0<_this.props.imageUrls.length-1){_this.loadImage((_this.state.currentShowIndex||0)+1);}return;}if(isLeftMove){_this.goBack.call(_this);}else if(isRightMove){_this.goNext.call(_this);return;}else{_this.resetPosition.call(_this);return;}};_this.goBack=function(){if(_this.state.currentShowIndex===0){_this.resetPosition.call(_this);return;}_this.positionXNumber=!react_native_1.I18nManager.isRTL?_this.standardPositionX+_this.width:_this.standardPositionX-_this.width;_this.standardPositionX=_this.positionXNumber;react_native_1.Animated.timing(_this.positionX,{toValue:_this.positionXNumber,duration:_this.props.pageAnimateTime,useNativeDriver:!!_this.props.useNativeDriver}).start();var nextIndex=(_this.state.currentShowIndex||0)-1;_this.setState({currentShowIndex:nextIndex},function(){if(_this.props.onChange){_this.props.onChange(_this.state.currentShowIndex);}});};_this.goNext=function(){if(_this.state.currentShowIndex===_this.props.imageUrls.length-1){_this.resetPosition.call(_this);return;}_this.positionXNumber=!react_native_1.I18nManager.isRTL?_this.standardPositionX-_this.width:_this.standardPositionX+_this.width;_this.standardPositionX=_this.positionXNumber;react_native_1.Animated.timing(_this.positionX,{toValue:_this.positionXNumber,duration:_this.props.pageAnimateTime,useNativeDriver:!!_this.props.useNativeDriver}).start();var nextIndex=(_this.state.currentShowIndex||0)+1;_this.setState({currentShowIndex:nextIndex},function(){if(_this.props.onChange){_this.props.onChange(_this.state.currentShowIndex);}});};_this.handleLongPress=function(image){if(_this.props.saveToLocalByLongPress){_this.setState({isShowMenu:true});}if(_this.props.onLongPress){_this.props.onLongPress(image);}};_this.handleClick=function(){if(_this.props.onClick){_this.props.onClick(_this.handleCancel,_this.state.currentShowIndex);}};_this.handleDoubleClick=function(){if(_this.props.onDoubleClick){_this.props.onDoubleClick(_this.handleCancel);}};_this.handleCancel=function(){_this.hasLayout=false;if(_this.props.onCancel){_this.props.onCancel();}};_this.handleLayout=function(event){if(event.nativeEvent.layout.width!==_this.width){_this.hasLayout=true;_this.width=event.nativeEvent.layout.width;_this.height=event.nativeEvent.layout.height;_this.styles=image_viewer_style_1.default(_this.width,_this.height,_this.props.backgroundColor||'transparent');_this.forceUpdate();_this.jumpToCurrentImage();}};_this.saveToLocal=function(){if(!_this.props.onSave){react_native_1.CameraRoll.saveToCameraRoll(_this.props.imageUrls[_this.state.currentShowIndex||0].url);_this.props.onSaveToCamera(_this.state.currentShowIndex);}else{_this.props.onSave(_this.props.imageUrls[_this.state.currentShowIndex||0].url);}_this.setState({isShowMenu:false});};_this.handleLeaveMenu=function(){_this.setState({isShowMenu:false});};_this.handleSwipeDown=function(){if(_this.props.onSwipeDown){_this.props.onSwipeDown();}_this.handleCancel();};return _this;}ImageViewer.prototype.componentDidMount=function(){this.init(this.props);};ImageViewer.getDerivedStateFromProps=function(nextProps,prevState){if(nextProps.index!==prevState.prevIndexProp){return{currentShowIndex:nextProps.index,prevIndexProp:nextProps.index};}return null;};ImageViewer.prototype.componentDidUpdate=function(prevProps,prevState){if(prevProps.index!==this.props.index){this.loadImage(this.props.index||0);this.jumpToCurrentImage();react_native_1.Animated.timing(this.fadeAnim,{toValue:1,duration:200,useNativeDriver:!!this.props.useNativeDriver}).start();}};ImageViewer.prototype.init=function(nextProps){var _this=this;if(nextProps.imageUrls.length===0){this.fadeAnim.setValue(0);return this.setState(new image_viewer_type_1.State());}var imageSizes=[];nextProps.imageUrls.forEach(function(imageUrl){imageSizes.push({width:imageUrl.width||0,height:imageUrl.height||0,status:'loading'});});this.setState({currentShowIndex:nextProps.index,prevIndexProp:nextProps.index||0,imageSizes:imageSizes},function(){_this.loadImage(nextProps.index||0);_this.jumpToCurrentImage();react_native_1.Animated.timing(_this.fadeAnim,{toValue:1,duration:200,useNativeDriver:!!nextProps.useNativeDriver}).start();});};ImageViewer.prototype.jumpToCurrentImage=function(){this.positionXNumber=this.width*(this.state.currentShowIndex||0)*(react_native_1.I18nManager.isRTL?1:-1);this.standardPositionX=this.positionXNumber;this.positionX.setValue(this.positionXNumber);};ImageViewer.prototype.loadImage=function(index){var _this=this;if(!this.state.imageSizes[index]){return;}if(this.loadedIndex.has(index)){return;}this.loadedIndex.set(index,true);var image=this.props.imageUrls[index];var imageStatus=__assign({},this.state.imageSizes[index]);var saveImageSize=function saveImageSize(){if(_this.state.imageSizes[index]&&_this.state.imageSizes[index].status!=='loading'){return;}var imageSizes=_this.state.imageSizes.slice();imageSizes[index]=imageStatus;_this.setState({imageSizes:imageSizes});};if(this.state.imageSizes[index].status==='success'){return;}if(this.state.imageSizes[index].width>0&&this.state.imageSizes[index].height>0){imageStatus.status='success';saveImageSize();return;}var sizeLoaded=false;var imageLoaded=false;if(!image.url||image.url.startsWith(\"file:\")){imageLoaded=true;}if(image.width&&image.height){if(this.props.enablePreload&&imageLoaded===false){react_native_1.Image.prefetch(image.url);}imageStatus.width=image.width;imageStatus.height=image.height;imageStatus.status='success';saveImageSize();return;}react_native_1.Image.getSize(image.url,function(width,height){imageStatus.width=width;imageStatus.height=height;imageStatus.status='success';saveImageSize();},function(){try{var data=react_native_1.Image.resolveAssetSource(image.props.source);imageStatus.width=data.width;imageStatus.height=data.height;imageStatus.status='success';saveImageSize();}catch(newError){imageStatus.status='fail';saveImageSize();}});};ImageViewer.prototype.resetPosition=function(){this.positionXNumber=this.standardPositionX;react_native_1.Animated.timing(this.positionX,{toValue:this.standardPositionX,duration:150,useNativeDriver:!!this.props.useNativeDriver}).start();};ImageViewer.prototype.getContent=function(){var _this=this;var screenWidth=this.width;var screenHeight=this.height;var ImageElements=this.props.imageUrls.map(function(image,index){if((_this.state.currentShowIndex||0)>index+1||(_this.state.currentShowIndex||0)<index-1){return _reactJsxRuntime.jsx(react_native_1.View,{style:{width:screenWidth,height:screenHeight}},index);}if(!_this.handleLongPressWithIndex.has(index)){_this.handleLongPressWithIndex.set(index,_this.handleLongPress.bind(_this,image));}var width=_this.state.imageSizes[index]&&_this.state.imageSizes[index].width;var height=_this.state.imageSizes[index]&&_this.state.imageSizes[index].height;var imageInfo=_this.state.imageSizes[index];if(!imageInfo||!imageInfo.status){return _reactJsxRuntime.jsx(react_native_1.View,{style:{width:screenWidth,height:screenHeight}},index);}if(width>screenWidth){var widthPixel=screenWidth/width;width*=widthPixel;height*=widthPixel;}if(height>screenHeight){var HeightPixel=screenHeight/height;width*=HeightPixel;height*=HeightPixel;}var Wrapper=function Wrapper(_a){var children=_a.children,others=__rest(_a,[\"children\"]);return _reactJsxRuntime.jsx(react_native_image_pan_zoom_1.default,_objectSpread(_objectSpread({cropWidth:_this.width,cropHeight:_this.height,maxOverflow:_this.props.maxOverflow,horizontalOuterRangeOffset:_this.handleHorizontalOuterRangeOffset,responderRelease:_this.handleResponderRelease,onMove:_this.props.onMove,onLongPress:_this.handleLongPressWithIndex.get(index),onClick:_this.handleClick,onDoubleClick:_this.handleDoubleClick,enableSwipeDown:_this.props.enableSwipeDown,swipeDownThreshold:_this.props.swipeDownThreshold,onSwipeDown:_this.handleSwipeDown,pinchToZoom:_this.props.enableImageZoom,enableDoubleClickZoom:_this.props.enableImageZoom,doubleClickInterval:_this.props.doubleClickInterval},others),{},{children:children}));};switch(imageInfo.status){case'loading':return _reactJsxRuntime.jsx(Wrapper,{style:__assign({},_this.styles.modalContainer,_this.styles.loadingContainer),imageWidth:screenWidth,imageHeight:screenHeight,children:_reactJsxRuntime.jsx(react_native_1.View,{style:_this.styles.loadingContainer,children:_this.props.loadingRender()})},index);case'success':if(!image.props){image.props={};}if(!image.props.style){image.props.style={};}image.props.style=__assign({},_this.styles.imageStyle,image.props.style,{width:width,height:height});if(typeof image.props.source==='number'){}else{if(!image.props.source){image.props.source={};}image.props.source=__assign({uri:image.url},image.props.source);}if(_this.props.enablePreload){_this.preloadImage(_this.state.currentShowIndex||0);}return _reactJsxRuntime.jsx(react_native_image_pan_zoom_1.default,{ref:function ref(el){return _this.imageRefs[index]=el;},cropWidth:_this.width,cropHeight:_this.height,maxOverflow:_this.props.maxOverflow,horizontalOuterRangeOffset:_this.handleHorizontalOuterRangeOffset,responderRelease:_this.handleResponderRelease,onMove:_this.props.onMove,onLongPress:_this.handleLongPressWithIndex.get(index),onClick:_this.handleClick,onDoubleClick:_this.handleDoubleClick,imageWidth:width,imageHeight:height,enableSwipeDown:_this.props.enableSwipeDown,swipeDownThreshold:_this.props.swipeDownThreshold,onSwipeDown:_this.handleSwipeDown,panToMove:!_this.state.isShowMenu,pinchToZoom:_this.props.enableImageZoom&&!_this.state.isShowMenu,enableDoubleClickZoom:_this.props.enableImageZoom&&!_this.state.isShowMenu,doubleClickInterval:_this.props.doubleClickInterval,minScale:_this.props.minScale,maxScale:_this.props.maxScale,children:_this.props.renderImage(image.props)},index);case'fail':return _reactJsxRuntime.jsx(Wrapper,{style:_this.styles.modalContainer,imageWidth:_this.props.failImageSource?_this.props.failImageSource.width:screenWidth,imageHeight:_this.props.failImageSource?_this.props.failImageSource.height:screenHeight,children:_this.props.failImageSource&&_this.props.renderImage({source:{uri:_this.props.failImageSource.url},style:{width:_this.props.failImageSource.width,height:_this.props.failImageSource.height}})},index);}});return _reactJsxRuntime.jsx(react_native_1.Animated.View,{style:{zIndex:9},children:_reactJsxRuntime.jsxs(react_native_1.Animated.View,{style:__assign({},this.styles.container,{opacity:this.fadeAnim}),children:[this.props.renderHeader(this.state.currentShowIndex),_reactJsxRuntime.jsx(react_native_1.View,{style:this.styles.arrowLeftContainer,children:_reactJsxRuntime.jsx(react_native_1.TouchableWithoutFeedback,{onPress:this.goBack,children:_reactJsxRuntime.jsx(react_native_1.View,{children:this.props.renderArrowLeft()})})}),_reactJsxRuntime.jsx(react_native_1.View,{style:this.styles.arrowRightContainer,children:_reactJsxRuntime.jsx(react_native_1.TouchableWithoutFeedback,{onPress:this.goNext,children:_reactJsxRuntime.jsx(react_native_1.View,{children:this.props.renderArrowRight()})})}),_reactJsxRuntime.jsx(react_native_1.Animated.View,{style:__assign({},this.styles.moveBox,{transform:[{translateX:this.positionX}],width:this.width*this.props.imageUrls.length}),children:ImageElements}),this.props.renderIndicator((this.state.currentShowIndex||0)+1,this.props.imageUrls.length),this.props.imageUrls[this.state.currentShowIndex||0]&&this.props.imageUrls[this.state.currentShowIndex||0].originSizeKb&&this.props.imageUrls[this.state.currentShowIndex||0].originUrl&&_reactJsxRuntime.jsx(react_native_1.View,{style:this.styles.watchOrigin,children:_reactJsxRuntime.jsx(react_native_1.TouchableOpacity,{style:this.styles.watchOriginTouchable,children:_reactJsxRuntime.jsx(react_native_1.Text,{style:this.styles.watchOriginText,children:\"\\u67E5\\u770B\\u539F\\u56FE(2M)\"})})}),_reactJsxRuntime.jsx(react_native_1.View,{style:[{bottom:0,position:'absolute',zIndex:9},this.props.footerContainerStyle],children:this.props.renderFooter(this.state.currentShowIndex||0)})]})});};ImageViewer.prototype.getMenu=function(){if(!this.state.isShowMenu){return null;}if(this.props.menus){return _reactJsxRuntime.jsx(react_native_1.View,{style:this.styles.menuContainer,children:this.props.menus({cancel:this.handleLeaveMenu,saveToLocal:this.saveToLocal})});}return _reactJsxRuntime.jsxs(react_native_1.View,{style:this.styles.menuContainer,children:[_reactJsxRuntime.jsx(react_native_1.View,{style:this.styles.menuShadow}),_reactJsxRuntime.jsxs(react_native_1.View,{style:this.styles.menuContent,children:[_reactJsxRuntime.jsx(react_native_1.TouchableHighlight,{underlayColor:\"#F2F2F2\",onPress:this.saveToLocal,style:this.styles.operateContainer,children:_reactJsxRuntime.jsx(react_native_1.Text,{style:this.styles.operateText,children:this.props.menuContext.saveToLocal})}),_reactJsxRuntime.jsx(react_native_1.TouchableHighlight,{underlayColor:\"#F2F2F2\",onPress:this.handleLeaveMenu,style:this.styles.operateContainer,children:_reactJsxRuntime.jsx(react_native_1.Text,{style:this.styles.operateText,children:this.props.menuContext.cancel})})]})]});};ImageViewer.prototype.render=function(){var childs=null;childs=_reactJsxRuntime.jsxs(react_native_1.View,{children:[this.getContent(),this.getMenu()]});return _reactJsxRuntime.jsx(react_native_1.View,{onLayout:this.handleLayout,style:__assign({flex:1,overflow:'hidden'},this.props.style),children:childs});};ImageViewer.defaultProps=new image_viewer_type_1.Props();return ImageViewer;}(React.Component);exports.default=ImageViewer;","map":{"version":3,"sources":["../src/image-viewer.component.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\n            t[p[i]] = s[p[i]];\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar React = require(\"react\");\nvar react_native_1 = require(\"react-native\");\nvar react_native_image_pan_zoom_1 = require(\"react-native-image-pan-zoom\");\nvar image_viewer_style_1 = require(\"./image-viewer.style\");\nvar image_viewer_type_1 = require(\"./image-viewer.type\");\nvar ImageViewer = /** @class */ (function (_super) {\n    __extends(ImageViewer, _super);\n    function ImageViewer() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.state = new image_viewer_type_1.State();\n        // 背景透明度渐变动画\n        _this.fadeAnim = new react_native_1.Animated.Value(0);\n        // 当前基准位置\n        _this.standardPositionX = 0;\n        // 整体位移，用来切换图片用\n        _this.positionXNumber = 0;\n        _this.positionX = new react_native_1.Animated.Value(0);\n        _this.width = 0;\n        _this.height = 0;\n        _this.styles = image_viewer_style_1.default(0, 0, 'transparent');\n        // 是否执行过 layout. fix 安卓不断触发 onLayout 的 bug\n        _this.hasLayout = false;\n        // 记录已加载的图片 index\n        _this.loadedIndex = new Map();\n        _this.handleLongPressWithIndex = new Map();\n        _this.imageRefs = [];\n        /**\n         * reset Image scale and position\n         */\n        _this.resetImageByIndex = function (index) {\n            _this.imageRefs[index] && _this.imageRefs[index].reset();\n        };\n        /**\n         * 预加载图片\n         */\n        _this.preloadImage = function (index) {\n            if (index < _this.state.imageSizes.length) {\n                _this.loadImage(index + 1);\n            }\n        };\n        /**\n         * 触发溢出水平滚动\n         */\n        _this.handleHorizontalOuterRangeOffset = function (offsetX) {\n            if (offsetX === void 0) { offsetX = 0; }\n            _this.positionXNumber = _this.standardPositionX + offsetX;\n            _this.positionX.setValue(_this.positionXNumber);\n            var offsetXRTL = !react_native_1.I18nManager.isRTL ? offsetX : -offsetX;\n            if (offsetXRTL < 0) {\n                if (_this.state.currentShowIndex || 0 < _this.props.imageUrls.length - 1) {\n                    _this.loadImage((_this.state.currentShowIndex || 0) + 1);\n                }\n            }\n            else if (offsetXRTL > 0) {\n                if (_this.state.currentShowIndex || 0 > 0) {\n                    _this.loadImage((_this.state.currentShowIndex || 0) - 1);\n                }\n            }\n        };\n        /**\n         * 手势结束，但是没有取消浏览大图\n         */\n        _this.handleResponderRelease = function (vx) {\n            if (vx === void 0) { vx = 0; }\n            var vxRTL = react_native_1.I18nManager.isRTL ? -vx : vx;\n            var isLeftMove = react_native_1.I18nManager.isRTL\n                ? _this.positionXNumber - _this.standardPositionX < -(_this.props.flipThreshold || 0)\n                : _this.positionXNumber - _this.standardPositionX > (_this.props.flipThreshold || 0);\n            var isRightMove = react_native_1.I18nManager.isRTL\n                ? _this.positionXNumber - _this.standardPositionX > (_this.props.flipThreshold || 0)\n                : _this.positionXNumber - _this.standardPositionX < -(_this.props.flipThreshold || 0);\n            if (vxRTL > 0.7) {\n                // 上一张\n                _this.goBack.call(_this);\n                // 这里可能没有触发溢出滚动，为了防止图片不被加载，调用加载图片\n                if (_this.state.currentShowIndex || 0 > 0) {\n                    _this.loadImage((_this.state.currentShowIndex || 0) - 1);\n                }\n                return;\n            }\n            else if (vxRTL < -0.7) {\n                // 下一张\n                _this.goNext.call(_this);\n                if (_this.state.currentShowIndex || 0 < _this.props.imageUrls.length - 1) {\n                    _this.loadImage((_this.state.currentShowIndex || 0) + 1);\n                }\n                return;\n            }\n            if (isLeftMove) {\n                // 上一张\n                _this.goBack.call(_this);\n            }\n            else if (isRightMove) {\n                // 下一张\n                _this.goNext.call(_this);\n                return;\n            }\n            else {\n                // 回到之前的位置\n                _this.resetPosition.call(_this);\n                return;\n            }\n        };\n        /**\n         * 到上一张\n         */\n        _this.goBack = function () {\n            if (_this.state.currentShowIndex === 0) {\n                // 回到之前的位置\n                _this.resetPosition.call(_this);\n                return;\n            }\n            _this.positionXNumber = !react_native_1.I18nManager.isRTL\n                ? _this.standardPositionX + _this.width\n                : _this.standardPositionX - _this.width;\n            _this.standardPositionX = _this.positionXNumber;\n            react_native_1.Animated.timing(_this.positionX, {\n                toValue: _this.positionXNumber,\n                duration: _this.props.pageAnimateTime,\n                useNativeDriver: !!_this.props.useNativeDriver\n            }).start();\n            var nextIndex = (_this.state.currentShowIndex || 0) - 1;\n            _this.setState({\n                currentShowIndex: nextIndex\n            }, function () {\n                if (_this.props.onChange) {\n                    _this.props.onChange(_this.state.currentShowIndex);\n                }\n            });\n        };\n        /**\n         * 到下一张\n         */\n        _this.goNext = function () {\n            if (_this.state.currentShowIndex === _this.props.imageUrls.length - 1) {\n                // 回到之前的位置\n                _this.resetPosition.call(_this);\n                return;\n            }\n            _this.positionXNumber = !react_native_1.I18nManager.isRTL\n                ? _this.standardPositionX - _this.width\n                : _this.standardPositionX + _this.width;\n            _this.standardPositionX = _this.positionXNumber;\n            react_native_1.Animated.timing(_this.positionX, {\n                toValue: _this.positionXNumber,\n                duration: _this.props.pageAnimateTime,\n                useNativeDriver: !!_this.props.useNativeDriver\n            }).start();\n            var nextIndex = (_this.state.currentShowIndex || 0) + 1;\n            _this.setState({\n                currentShowIndex: nextIndex\n            }, function () {\n                if (_this.props.onChange) {\n                    _this.props.onChange(_this.state.currentShowIndex);\n                }\n            });\n        };\n        /**\n         * 长按\n         */\n        _this.handleLongPress = function (image) {\n            if (_this.props.saveToLocalByLongPress) {\n                // 出现保存到本地的操作框\n                _this.setState({ isShowMenu: true });\n            }\n            if (_this.props.onLongPress) {\n                _this.props.onLongPress(image);\n            }\n        };\n        /**\n         * 单击\n         */\n        _this.handleClick = function () {\n            if (_this.props.onClick) {\n                _this.props.onClick(_this.handleCancel, _this.state.currentShowIndex);\n            }\n        };\n        /**\n         * 双击\n         */\n        _this.handleDoubleClick = function () {\n            if (_this.props.onDoubleClick) {\n                _this.props.onDoubleClick(_this.handleCancel);\n            }\n        };\n        /**\n         * 退出\n         */\n        _this.handleCancel = function () {\n            _this.hasLayout = false;\n            if (_this.props.onCancel) {\n                _this.props.onCancel();\n            }\n        };\n        /**\n         * 完成布局\n         */\n        _this.handleLayout = function (event) {\n            if (event.nativeEvent.layout.width !== _this.width) {\n                _this.hasLayout = true;\n                _this.width = event.nativeEvent.layout.width;\n                _this.height = event.nativeEvent.layout.height;\n                _this.styles = image_viewer_style_1.default(_this.width, _this.height, _this.props.backgroundColor || 'transparent');\n                // 强制刷新\n                _this.forceUpdate();\n                _this.jumpToCurrentImage();\n            }\n        };\n        /**\n         * 保存当前图片到本地相册\n         */\n        _this.saveToLocal = function () {\n            if (!_this.props.onSave) {\n                react_native_1.CameraRoll.saveToCameraRoll(_this.props.imageUrls[_this.state.currentShowIndex || 0].url);\n                _this.props.onSaveToCamera(_this.state.currentShowIndex);\n            }\n            else {\n                _this.props.onSave(_this.props.imageUrls[_this.state.currentShowIndex || 0].url);\n            }\n            _this.setState({ isShowMenu: false });\n        };\n        _this.handleLeaveMenu = function () {\n            _this.setState({ isShowMenu: false });\n        };\n        _this.handleSwipeDown = function () {\n            if (_this.props.onSwipeDown) {\n                _this.props.onSwipeDown();\n            }\n            _this.handleCancel();\n        };\n        return _this;\n    }\n    ImageViewer.prototype.componentDidMount = function () {\n        this.init(this.props);\n    };\n    ImageViewer.getDerivedStateFromProps = function (nextProps, prevState) {\n        if (nextProps.index !== prevState.prevIndexProp) {\n            return { currentShowIndex: nextProps.index, prevIndexProp: nextProps.index };\n        }\n        return null;\n    };\n    ImageViewer.prototype.componentDidUpdate = function (prevProps, prevState) {\n        if (prevProps.index !== this.props.index) {\n            // 立刻预加载要看的图\n            this.loadImage(this.props.index || 0);\n            this.jumpToCurrentImage();\n            // 显示动画\n            react_native_1.Animated.timing(this.fadeAnim, {\n                toValue: 1,\n                duration: 200,\n                useNativeDriver: !!this.props.useNativeDriver\n            }).start();\n        }\n    };\n    /**\n     * props 有变化时执行\n     */\n    ImageViewer.prototype.init = function (nextProps) {\n        var _this = this;\n        if (nextProps.imageUrls.length === 0) {\n            // 隐藏时候清空\n            this.fadeAnim.setValue(0);\n            return this.setState(new image_viewer_type_1.State());\n        }\n        // 给 imageSizes 塞入空数组\n        var imageSizes = [];\n        nextProps.imageUrls.forEach(function (imageUrl) {\n            imageSizes.push({\n                width: imageUrl.width || 0,\n                height: imageUrl.height || 0,\n                status: 'loading'\n            });\n        });\n        this.setState({\n            currentShowIndex: nextProps.index,\n            prevIndexProp: nextProps.index || 0,\n            imageSizes: imageSizes\n        }, function () {\n            // 立刻预加载要看的图\n            _this.loadImage(nextProps.index || 0);\n            _this.jumpToCurrentImage();\n            // 显示动画\n            react_native_1.Animated.timing(_this.fadeAnim, {\n                toValue: 1,\n                duration: 200,\n                useNativeDriver: !!nextProps.useNativeDriver\n            }).start();\n        });\n    };\n    /**\n     * 调到当前看图位置\n     */\n    ImageViewer.prototype.jumpToCurrentImage = function () {\n        // 跳到当前图的位置\n        this.positionXNumber = this.width * (this.state.currentShowIndex || 0) * (react_native_1.I18nManager.isRTL ? 1 : -1);\n        this.standardPositionX = this.positionXNumber;\n        this.positionX.setValue(this.positionXNumber);\n    };\n    /**\n     * 加载图片，主要是获取图片长与宽\n     */\n    ImageViewer.prototype.loadImage = function (index) {\n        var _this = this;\n        if (!this.state.imageSizes[index]) {\n            return;\n        }\n        if (this.loadedIndex.has(index)) {\n            return;\n        }\n        this.loadedIndex.set(index, true);\n        var image = this.props.imageUrls[index];\n        var imageStatus = __assign({}, this.state.imageSizes[index]);\n        // 保存 imageSize\n        var saveImageSize = function () {\n            // 如果已经 success 了，就不做处理\n            if (_this.state.imageSizes[index] && _this.state.imageSizes[index].status !== 'loading') {\n                return;\n            }\n            var imageSizes = _this.state.imageSizes.slice();\n            imageSizes[index] = imageStatus;\n            _this.setState({ imageSizes: imageSizes });\n        };\n        if (this.state.imageSizes[index].status === 'success') {\n            // 已经加载过就不会加载了\n            return;\n        }\n        // 如果已经有宽高了，直接设置为 success\n        if (this.state.imageSizes[index].width > 0 && this.state.imageSizes[index].height > 0) {\n            imageStatus.status = 'success';\n            saveImageSize();\n            return;\n        }\n        // 是否加载完毕了图片大小\n        var sizeLoaded = false;\n        // 是否加载完毕了图片\n        var imageLoaded = false;\n        // Tagged success if url is started with file:, or not set yet(for custom source.uri).\n        if (!image.url || image.url.startsWith(\"file:\")) {\n            imageLoaded = true;\n        }\n        // 如果已知源图片宽高，直接设置为 success\n        if (image.width && image.height) {\n            if (this.props.enablePreload && imageLoaded === false) {\n                react_native_1.Image.prefetch(image.url);\n            }\n            imageStatus.width = image.width;\n            imageStatus.height = image.height;\n            imageStatus.status = 'success';\n            saveImageSize();\n            return;\n        }\n        react_native_1.Image.getSize(image.url, function (width, height) {\n            imageStatus.width = width;\n            imageStatus.height = height;\n            imageStatus.status = 'success';\n            saveImageSize();\n        }, function () {\n            try {\n                var data = react_native_1.Image.resolveAssetSource(image.props.source);\n                imageStatus.width = data.width;\n                imageStatus.height = data.height;\n                imageStatus.status = 'success';\n                saveImageSize();\n            }\n            catch (newError) {\n                // Give up..\n                imageStatus.status = 'fail';\n                saveImageSize();\n            }\n        });\n    };\n    /**\n     * 回到原位\n     */\n    ImageViewer.prototype.resetPosition = function () {\n        this.positionXNumber = this.standardPositionX;\n        react_native_1.Animated.timing(this.positionX, {\n            toValue: this.standardPositionX,\n            duration: 150,\n            useNativeDriver: !!this.props.useNativeDriver\n        }).start();\n    };\n    /**\n     * 获得整体内容\n     */\n    ImageViewer.prototype.getContent = function () {\n        var _this = this;\n        // 获得屏幕宽高\n        var screenWidth = this.width;\n        var screenHeight = this.height;\n        var ImageElements = this.props.imageUrls.map(function (image, index) {\n            if ((_this.state.currentShowIndex || 0) > index + 1 || (_this.state.currentShowIndex || 0) < index - 1) {\n                return <react_native_1.View key={index} style={{ width: screenWidth, height: screenHeight }}/>;\n            }\n            if (!_this.handleLongPressWithIndex.has(index)) {\n                _this.handleLongPressWithIndex.set(index, _this.handleLongPress.bind(_this, image));\n            }\n            var width = _this.state.imageSizes[index] && _this.state.imageSizes[index].width;\n            var height = _this.state.imageSizes[index] && _this.state.imageSizes[index].height;\n            var imageInfo = _this.state.imageSizes[index];\n            if (!imageInfo || !imageInfo.status) {\n                return <react_native_1.View key={index} style={{ width: screenWidth, height: screenHeight }}/>;\n            }\n            // 如果宽大于屏幕宽度,整体缩放到宽度是屏幕宽度\n            if (width > screenWidth) {\n                var widthPixel = screenWidth / width;\n                width *= widthPixel;\n                height *= widthPixel;\n            }\n            // 如果此时高度还大于屏幕高度,整体缩放到高度是屏幕高度\n            if (height > screenHeight) {\n                var HeightPixel = screenHeight / height;\n                width *= HeightPixel;\n                height *= HeightPixel;\n            }\n            var Wrapper = function (_a) {\n                var children = _a.children, others = __rest(_a, [\"children\"]);\n                return (<react_native_image_pan_zoom_1.default cropWidth={_this.width} cropHeight={_this.height} maxOverflow={_this.props.maxOverflow} horizontalOuterRangeOffset={_this.handleHorizontalOuterRangeOffset} responderRelease={_this.handleResponderRelease} onMove={_this.props.onMove} onLongPress={_this.handleLongPressWithIndex.get(index)} onClick={_this.handleClick} onDoubleClick={_this.handleDoubleClick} enableSwipeDown={_this.props.enableSwipeDown} swipeDownThreshold={_this.props.swipeDownThreshold} onSwipeDown={_this.handleSwipeDown} pinchToZoom={_this.props.enableImageZoom} enableDoubleClickZoom={_this.props.enableImageZoom} doubleClickInterval={_this.props.doubleClickInterval} {...others}>\n          {children}\n        </react_native_image_pan_zoom_1.default>);\n            };\n            switch (imageInfo.status) {\n                case 'loading':\n                    return (<Wrapper key={index} style={__assign({}, _this.styles.modalContainer, _this.styles.loadingContainer)} imageWidth={screenWidth} imageHeight={screenHeight}>\n              <react_native_1.View style={_this.styles.loadingContainer}>{_this.props.loadingRender()}</react_native_1.View>\n            </Wrapper>);\n                case 'success':\n                    if (!image.props) {\n                        image.props = {};\n                    }\n                    if (!image.props.style) {\n                        image.props.style = {};\n                    }\n                    image.props.style = __assign({}, _this.styles.imageStyle, image.props.style, { width: width,\n                        height: height });\n                    if (typeof image.props.source === 'number') {\n                        // source = require(..), doing nothing\n                    }\n                    else {\n                        if (!image.props.source) {\n                            image.props.source = {};\n                        }\n                        image.props.source = __assign({ uri: image.url }, image.props.source);\n                    }\n                    if (_this.props.enablePreload) {\n                        _this.preloadImage(_this.state.currentShowIndex || 0);\n                    }\n                    return (<react_native_image_pan_zoom_1.default key={index} ref={function (el) { return (_this.imageRefs[index] = el); }} cropWidth={_this.width} cropHeight={_this.height} maxOverflow={_this.props.maxOverflow} horizontalOuterRangeOffset={_this.handleHorizontalOuterRangeOffset} responderRelease={_this.handleResponderRelease} onMove={_this.props.onMove} onLongPress={_this.handleLongPressWithIndex.get(index)} onClick={_this.handleClick} onDoubleClick={_this.handleDoubleClick} imageWidth={width} imageHeight={height} enableSwipeDown={_this.props.enableSwipeDown} swipeDownThreshold={_this.props.swipeDownThreshold} onSwipeDown={_this.handleSwipeDown} panToMove={!_this.state.isShowMenu} pinchToZoom={_this.props.enableImageZoom && !_this.state.isShowMenu} enableDoubleClickZoom={_this.props.enableImageZoom && !_this.state.isShowMenu} doubleClickInterval={_this.props.doubleClickInterval} minScale={_this.props.minScale} maxScale={_this.props.maxScale}>\n              {_this.props.renderImage(image.props)}\n            </react_native_image_pan_zoom_1.default>);\n                case 'fail':\n                    return (<Wrapper key={index} style={_this.styles.modalContainer} imageWidth={_this.props.failImageSource ? _this.props.failImageSource.width : screenWidth} imageHeight={_this.props.failImageSource ? _this.props.failImageSource.height : screenHeight}>\n              {_this.props.failImageSource &&\n                        _this.props.renderImage({\n                            source: {\n                                uri: _this.props.failImageSource.url\n                            },\n                            style: {\n                                width: _this.props.failImageSource.width,\n                                height: _this.props.failImageSource.height\n                            }\n                        })}\n            </Wrapper>);\n            }\n        });\n        return (<react_native_1.Animated.View style={{ zIndex: 9 }}>\n        <react_native_1.Animated.View style={__assign({}, this.styles.container, { opacity: this.fadeAnim })}>\n          {this.props.renderHeader(this.state.currentShowIndex)}\n\n          <react_native_1.View style={this.styles.arrowLeftContainer}>\n            <react_native_1.TouchableWithoutFeedback onPress={this.goBack}>\n              <react_native_1.View>{this.props.renderArrowLeft()}</react_native_1.View>\n            </react_native_1.TouchableWithoutFeedback>\n          </react_native_1.View>\n\n          <react_native_1.View style={this.styles.arrowRightContainer}>\n            <react_native_1.TouchableWithoutFeedback onPress={this.goNext}>\n              <react_native_1.View>{this.props.renderArrowRight()}</react_native_1.View>\n            </react_native_1.TouchableWithoutFeedback>\n          </react_native_1.View>\n\n          <react_native_1.Animated.View style={__assign({}, this.styles.moveBox, { transform: [{ translateX: this.positionX }], width: this.width * this.props.imageUrls.length })}>\n            {ImageElements}\n          </react_native_1.Animated.View>\n          {this.props.renderIndicator((this.state.currentShowIndex || 0) + 1, this.props.imageUrls.length)}\n\n          {this.props.imageUrls[this.state.currentShowIndex || 0] &&\n            this.props.imageUrls[this.state.currentShowIndex || 0].originSizeKb &&\n            this.props.imageUrls[this.state.currentShowIndex || 0].originUrl && (<react_native_1.View style={this.styles.watchOrigin}>\n                <react_native_1.TouchableOpacity style={this.styles.watchOriginTouchable}>\n                  <react_native_1.Text style={this.styles.watchOriginText}>查看原图(2M)</react_native_1.Text>\n                </react_native_1.TouchableOpacity>\n              </react_native_1.View>)}\n          <react_native_1.View style={[{ bottom: 0, position: 'absolute', zIndex: 9 }, this.props.footerContainerStyle]}>\n            {this.props.renderFooter(this.state.currentShowIndex || 0)}\n          </react_native_1.View>\n        </react_native_1.Animated.View>\n      </react_native_1.Animated.View>);\n    };\n    ImageViewer.prototype.getMenu = function () {\n        if (!this.state.isShowMenu) {\n            return null;\n        }\n        if (this.props.menus) {\n            return (<react_native_1.View style={this.styles.menuContainer}>\n          {this.props.menus({ cancel: this.handleLeaveMenu, saveToLocal: this.saveToLocal })}\n        </react_native_1.View>);\n        }\n        return (<react_native_1.View style={this.styles.menuContainer}>\n        <react_native_1.View style={this.styles.menuShadow}/>\n        <react_native_1.View style={this.styles.menuContent}>\n          <react_native_1.TouchableHighlight underlayColor=\"#F2F2F2\" onPress={this.saveToLocal} style={this.styles.operateContainer}>\n            <react_native_1.Text style={this.styles.operateText}>{this.props.menuContext.saveToLocal}</react_native_1.Text>\n          </react_native_1.TouchableHighlight>\n          <react_native_1.TouchableHighlight underlayColor=\"#F2F2F2\" onPress={this.handleLeaveMenu} style={this.styles.operateContainer}>\n            <react_native_1.Text style={this.styles.operateText}>{this.props.menuContext.cancel}</react_native_1.Text>\n          </react_native_1.TouchableHighlight>\n        </react_native_1.View>\n      </react_native_1.View>);\n    };\n    ImageViewer.prototype.render = function () {\n        var childs = null;\n        childs = (<react_native_1.View>\n        {this.getContent()}\n        {this.getMenu()}\n      </react_native_1.View>);\n        return (<react_native_1.View onLayout={this.handleLayout} style={__assign({ flex: 1, overflow: 'hidden' }, this.props.style)}>\n        {childs}\n      </react_native_1.View>);\n    };\n    ImageViewer.defaultProps = new image_viewer_type_1.Props();\n    return ImageViewer;\n}(React.Component));\nexports.default = ImageViewer;\n//# sourceMappingURL=image-viewer.component.js.map"]},"metadata":{},"sourceType":"script"}